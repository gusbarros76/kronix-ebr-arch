<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kronix EBR ‚Äî Arquitetura & Fluxo de Processo</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e17;
    --bg2: #0f1520;
    --bg3: #151d2e;
    --border: #1e2d45;
    --border-light: #263548;
    --text: #c8d8f0;
    --text-dim: #5a7a9a;
    --text-bright: #e8f0ff;
    --accent: #00b4d8;
    --accent2: #0077b6;
    --accent-glow: rgba(0,180,216,0.15);
    --green: #06d6a0;
    --green-dim: rgba(6,214,160,0.12);
    --orange: #f77f00;
    --orange-dim: rgba(247,127,0,0.12);
    --red: #ef233c;
    --red-dim: rgba(239,35,60,0.1);
    --purple: #7b2d8b;
    --purple-light: #c77dff;
    --gold: #ffd60a;
    --gold-dim: rgba(255,214,10,0.1);
    --sap: #1a6b3c;
    --sap-light: #29a05a;
    --evolutio: #7c3aed;
    --evolutio-light: #a78bfa;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 13px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  header {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    padding: 18px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-mark {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 600;
    font-size: 14px;
    color: #fff;
    letter-spacing: -1px;
  }

  .header-title {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-bright);
    letter-spacing: 0.3px;
  }

  .header-sub {
    font-size: 11px;
    color: var(--text-dim);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 2px;
  }

  .header-badges {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .badge {
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 10px;
    font-family: 'IBM Plex Mono', monospace;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .badge-gxp {
    background: var(--red-dim);
    border: 1px solid rgba(239,35,60,0.3);
    color: #ff6b81;
  }

  .badge-anvisa {
    background: var(--gold-dim);
    border: 1px solid rgba(255,214,10,0.3);
    color: var(--gold);
  }

  .badge-fda {
    background: rgba(0,119,182,0.15);
    border: 1px solid rgba(0,119,182,0.3);
    color: var(--accent);
  }

  /* MAIN CONTAINER */
  .main {
    padding: 28px 32px;
    max-width: 1600px;
    margin: 0 auto;
  }

  /* SECTION LABELS */
  .section-label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .section-label-text {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
  }

  .section-label-line {
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* LAYER 1: PROCESS FLOW */
  .process-layer {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 24px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }

  .process-layer::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent), var(--green), var(--accent2));
  }

  .process-title {
    font-size: 11px;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--text-dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .process-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* FLOW PIPELINE */
  .pipeline {
    display: flex;
    align-items: flex-start;
    gap: 0;
    overflow-x: auto;
    padding-bottom: 8px;
  }

  .pipeline-stage {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-shrink: 0;
  }

  .pipeline-connector {
    display: flex;
    align-items: center;
    flex-shrink: 0;
    margin-top: 18px;
  }

  .connector-line {
    width: 24px;
    height: 2px;
    background: var(--border-light);
  }

  .connector-arrow {
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 7px solid var(--border-light);
  }

  /* PROCESS NODE */
  .pnode {
    position: relative;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 14px;
    min-width: 120px;
    max-width: 140px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
  }

  .pnode:hover {
    border-color: var(--accent);
    box-shadow: 0 0 16px var(--accent-glow);
    transform: translateY(-2px);
  }

  .pnode.start-node {
    border-color: var(--green);
    background: var(--green-dim);
    box-shadow: 0 0 12px rgba(6,214,160,0.08);
  }

  .pnode.op-node {
    border-color: var(--accent2);
    background: rgba(0,119,182,0.08);
    min-width: 130px;
  }

  .pnode.gxp-node {
    border-color: rgba(239,35,60,0.4);
    background: var(--red-dim);
  }

  .pnode.sap-node {
    border-color: rgba(41,160,90,0.4);
    background: rgba(41,160,90,0.08);
  }

  .pnode.gq-node {
    border-color: rgba(255,214,10,0.4);
    background: var(--gold-dim);
  }

  .pnode-icon {
    font-size: 18px;
    margin-bottom: 5px;
  }

  .pnode-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-bright);
    line-height: 1.3;
  }

  .pnode-sub {
    font-size: 9px;
    color: var(--text-dim);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 3px;
  }

  .pnode-tag {
    display: inline-block;
    margin-top: 5px;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 8px;
    font-family: 'IBM Plex Mono', monospace;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .tag-ebr { background: rgba(0,180,216,0.15); color: var(--accent); }
  .tag-sap { background: rgba(41,160,90,0.15); color: #29a05a; }
  .tag-evolutio { background: rgba(167,139,250,0.15); color: var(--evolutio-light); }
  .tag-gq { background: rgba(255,214,10,0.15); color: var(--gold); }
  .tag-wms { background: rgba(247,127,0,0.15); color: var(--orange); }

  /* OPs GRID */
  .ops-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 20px;
  }

  .op-card {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.25s;
    cursor: pointer;
  }

  .op-card:hover {
    border-color: var(--accent);
    box-shadow: 0 4px 24px rgba(0,180,216,0.1);
    transform: translateY(-2px);
  }

  .op-header {
    padding: 10px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .op-header-70 { background: rgba(0,119,182,0.15); border-bottom: 1px solid rgba(0,119,182,0.2); }
  .op-header-77 { background: rgba(6,214,160,0.1); border-bottom: 1px solid rgba(6,214,160,0.2); }
  .op-header-montagem { background: rgba(247,127,0,0.1); border-bottom: 1px solid rgba(247,127,0,0.2); }

  .op-code {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1px;
  }

  .op-code-70 { color: var(--accent); }
  .op-code-77 { color: var(--green); }
  .op-code-montagem { color: var(--orange); }

  .op-name { font-size: 12px; font-weight: 600; color: var(--text-bright); }

  .op-body { padding: 12px 14px; }

  .op-steps {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .op-step {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 6px 0;
    border-bottom: 1px solid rgba(30,45,69,0.5);
    position: relative;
  }

  .op-step:last-child { border-bottom: none; }

  .step-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin-top: 3px;
    flex-shrink: 0;
  }

  .dot-ebr { background: var(--accent); box-shadow: 0 0 4px var(--accent); }
  .dot-sap { background: var(--sap-light); }
  .dot-evolutio { background: var(--evolutio-light); }
  .dot-gq { background: var(--gold); }
  .dot-wms { background: var(--orange); }

  .step-content { flex: 1; }

  .step-name {
    font-size: 11px;
    font-weight: 500;
    color: var(--text);
    line-height: 1.3;
  }

  .step-system {
    font-size: 9px;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--text-dim);
    margin-top: 1px;
  }

  .step-badge {
    padding: 1px 5px;
    border-radius: 3px;
    font-size: 8px;
    font-family: 'IBM Plex Mono', monospace;
    flex-shrink: 0;
    align-self: center;
  }

  /* LAYER 2: ARCHITECTURE */
  .arch-layer {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 24px;
    position: relative;
    overflow: hidden;
  }

  .arch-layer::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--purple-light), var(--accent), var(--green));
  }

  /* ARCH GRID */
  .arch-grid {
    display: grid;
    grid-template-columns: 180px 1fr 180px;
    gap: 20px;
    align-items: start;
  }

  /* SYSTEM BOXES */
  .sys-box {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.25s;
    cursor: pointer;
  }

  .sys-box:hover {
    transform: translateY(-2px);
  }

  .sys-box-header {
    padding: 10px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .sys-icon {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .sys-name {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-bright);
  }

  .sys-role {
    font-size: 9px;
    color: var(--text-dim);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 1px;
  }

  .sys-body {
    padding: 8px 12px 10px;
    border-top: 1px solid var(--border);
  }

  .sys-detail {
    font-size: 10px;
    color: var(--text-dim);
    line-height: 1.5;
    margin-bottom: 4px;
  }

  .sys-detail strong { color: var(--text); font-weight: 500; }

  /* KRONIX CORE */
  .kronix-core {
    background: var(--bg3);
    border: 1px solid var(--accent);
    border-radius: 10px;
    box-shadow: 0 0 30px rgba(0,180,216,0.08), inset 0 0 40px rgba(0,180,216,0.02);
    overflow: hidden;
    position: relative;
  }

  .gxp-boundary {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 10px;
    border: 2px dashed rgba(239,35,60,0.25);
    pointer-events: none;
  }

  .kronix-header {
    background: linear-gradient(135deg, rgba(0,119,182,0.2), rgba(0,180,216,0.1));
    padding: 12px 16px;
    border-bottom: 1px solid rgba(0,180,216,0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .kronix-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: 0.5px;
  }

  .kronix-sub {
    font-size: 9px;
    color: var(--text-dim);
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 2px;
  }

  .kronix-body {
    padding: 16px;
  }

  /* MODULES GRID */
  .modules-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 14px;
  }

  .module-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 12px;
    transition: all 0.2s;
    cursor: pointer;
  }

  .module-card:hover {
    border-color: var(--accent);
    box-shadow: 0 0 12px var(--accent-glow);
  }

  .module-card.active {
    border-color: var(--accent);
    background: rgba(0,180,216,0.05);
  }

  .module-name {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-bright);
    margin-bottom: 2px;
  }

  .module-desc {
    font-size: 9px;
    color: var(--text-dim);
    font-family: 'IBM Plex Mono', monospace;
  }

  /* AUDIT TRAIL SERVICE */
  .audit-service {
    background: var(--bg2);
    border: 1px solid rgba(239,35,60,0.35);
    border-radius: 8px;
    overflow: hidden;
    margin-top: 12px;
    transition: all 0.25s;
    cursor: pointer;
  }

  .audit-service:hover {
    border-color: rgba(239,35,60,0.6);
    box-shadow: 0 0 16px rgba(239,35,60,0.08);
  }

  .audit-header {
    background: var(--red-dim);
    padding: 8px 12px;
    border-bottom: 1px solid rgba(239,35,60,0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .audit-title {
    font-size: 11px;
    font-weight: 600;
    color: #ff6b81;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .audit-body {
    padding: 10px 12px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }

  .audit-component {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 7px 9px;
    text-align: center;
  }

  .audit-comp-icon { font-size: 14px; margin-bottom: 3px; }
  .audit-comp-name { font-size: 9px; font-weight: 600; color: var(--text); }
  .audit-comp-desc { font-size: 8px; color: var(--text-dim); font-family: 'IBM Plex Mono', monospace; margin-top: 1px; }

  /* AWS INFRA */
  .aws-infra {
    background: var(--bg2);
    border: 1px solid rgba(247,127,0,0.25);
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
  }

  .aws-title {
    font-size: 9px;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--orange);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .aws-title::after { content: ''; flex: 1; height: 1px; background: rgba(247,127,0,0.2); }

  .aws-services {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .aws-chip {
    padding: 4px 9px;
    background: rgba(247,127,0,0.08);
    border: 1px solid rgba(247,127,0,0.2);
    border-radius: 4px;
    font-size: 9px;
    font-family: 'IBM Plex Mono', monospace;
    color: #ffa940;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .aws-chip:hover {
    background: rgba(247,127,0,0.15);
    border-color: rgba(247,127,0,0.4);
  }

  /* INTEGRATION ARROWS */
  .integrations-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
  }

  .integration-card {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 12px;
    transition: all 0.2s;
  }

  .integration-card:hover {
    border-color: var(--border-light);
    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
  }

  .int-header {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 7px;
  }

  .int-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
  .int-name { font-size: 10px; font-weight: 600; color: var(--text-bright); }
  .int-protocol {
    margin-left: auto;
    font-size: 8px;
    font-family: 'IBM Plex Mono', monospace;
    padding: 2px 5px;
    border-radius: 3px;
    background: var(--bg2);
    color: var(--text-dim);
  }

  .int-detail {
    font-size: 9px;
    color: var(--text-dim);
    line-height: 1.5;
  }

  /* LEGEND */
  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 20px;
    padding: 12px 16px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 6px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 10px;
    color: var(--text-dim);
  }

  .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
  .legend-line { width: 16px; height: 2px; border-radius: 1px; }
  .legend-dashed { width: 16px; height: 2px; border-radius: 1px; background: repeating-linear-gradient(90deg, rgba(239,35,60,0.5) 0, rgba(239,35,60,0.5) 4px, transparent 4px, transparent 8px); }

  /* TOOLTIP */
  .tooltip {
    position: fixed;
    background: var(--bg2);
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 10px 14px;
    max-width: 260px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    z-index: 1000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    font-size: 11px;
  }

  .tooltip.visible { opacity: 1; }
  .tooltip-title { font-weight: 600; color: var(--text-bright); margin-bottom: 5px; }
  .tooltip-body { color: var(--text-dim); line-height: 1.5; }
  .tooltip-adr { margin-top: 6px; font-family: 'IBM Plex Mono', monospace; font-size: 9px; color: var(--accent); }

  /* GAP INDICATOR */
  .gap-indicator {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 6px;
    background: rgba(255,214,10,0.1);
    border: 1px solid rgba(255,214,10,0.3);
    border-radius: 3px;
    font-size: 8px;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--gold);
  }

  /* DIVIDER */
  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
    margin: 24px 0;
  }

  /* RISKS PANEL */
  .risks-panel {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 20px;
  }

  .risk-card {
    background: var(--bg3);
    border-radius: 6px;
    padding: 12px 14px;
    border-left: 3px solid transparent;
    transition: all 0.2s;
  }

  .risk-high { border-color: var(--red); }
  .risk-medium { border-color: var(--orange); }
  .risk-low { border-color: var(--green); }

  .risk-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 6px;
  }

  .risk-title { font-size: 11px; font-weight: 600; color: var(--text-bright); }
  .risk-level {
    font-size: 8px;
    font-family: 'IBM Plex Mono', monospace;
    padding: 2px 5px;
    border-radius: 3px;
    text-transform: uppercase;
  }

  .risk-level-high { background: var(--red-dim); color: #ff6b81; }
  .risk-level-medium { background: var(--orange-dim); color: var(--orange); }
  .risk-level-low { background: var(--green-dim); color: var(--green); }

  .risk-body { font-size: 10px; color: var(--text-dim); line-height: 1.5; }

  /* SCROLL ANIMATIONS */
  .fade-in {
    opacity: 0;
    transform: translateY(16px);
    animation: fadeInUp 0.5s ease forwards;
  }

  @keyframes fadeInUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in:nth-child(1) { animation-delay: 0.05s; }
  .fade-in:nth-child(2) { animation-delay: 0.12s; }
  .fade-in:nth-child(3) { animation-delay: 0.18s; }
  .fade-in:nth-child(4) { animation-delay: 0.24s; }

  /* PULSE BADGE */
  .pulse-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--green);
    box-shadow: 0 0 0 0 rgba(6,214,160,0.4);
    animation: pulse 2s infinite;
    display: inline-block;
  }

  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(6,214,160,0.4); }
    70% { box-shadow: 0 0 0 6px rgba(6,214,160,0); }
    100% { box-shadow: 0 0 0 0 rgba(6,214,160,0); }
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg2); }
  ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }

  .section-divider {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 24px 0 16px;
  }

  .section-divider-text {
    font-size: 10px;
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    white-space: nowrap;
  }

  .section-divider-line {
    flex: 1;
    height: 1px;
    background: var(--border);
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-left">
    <div class="logo-mark">Kx</div>
    <div>
      <div class="header-title">Kronix EBR ‚Äî Arquitetura & Fluxo de Processo</div>
      <div class="header-sub">NC Tech ¬∑ RBBL Wave 1 ¬∑ Go Live dez/2026 ¬∑ ADR-001 v3 / ADR-004 v1</div>
    </div>
  </div>
  <div class="header-badges">
    <span class="badge badge-gxp">GxP Regulado</span>
    <span class="badge badge-anvisa">ANVISA RDC 301</span>
    <span class="badge badge-fda">FDA 21 CFR Pt.11</span>
    <span style="display:flex;align-items:center;gap:5px;font-size:10px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">
      <span class="pulse-dot"></span> PROPOSTO
    </span>
  </div>
</header>

<!-- TOOLTIP -->
<div class="tooltip" id="tooltip">
  <div class="tooltip-title" id="tt-title"></div>
  <div class="tooltip-body" id="tt-body"></div>
  <div class="tooltip-adr" id="tt-adr"></div>
</div>

<div class="main">

  <!-- ======== LAYER 1: PROCESS FLOW ======== -->
  <div class="section-divider fade-in">
    <span class="section-divider-text">// Camada 1 ‚Äî Fluxo de Processo AS-IS</span>
    <div class="section-divider-line"></div>
    <span class="badge badge-fda" style="font-size:9px;">Supply Chain ‚Üí Ch√£o de F√°brica</span>
  </div>

  <div class="process-layer fade-in">
    <div class="process-title">Pipeline Principal ‚Äî Da Demanda ao Produto</div>

    <!-- TOP PIPELINE -->
    <div class="pipeline" style="margin-bottom: 20px;">

      <div class="pipeline-stage">
        <div class="pnode start-node" data-tt-title="Start ‚Äî Demanda Comercial" data-tt-body="Origem do processo de fabrica√ß√£o. Demanda de vendas dispara programa√ß√£o no PCP." data-tt-adr="Fora do escopo EBR ‚Äî upstream SAP SD/PP">
          <div class="pnode-icon">üè≠</div>
          <div class="pnode-label">Demanda Comercial</div>
          <div class="pnode-sub">IN√çCIO</div>
        </div>
      </div>

      <div class="pipeline-connector"><div class="connector-line"></div><div class="connector-arrow"></div></div>

      <div class="pipeline-stage">
        <div class="pnode sap-node" data-tt-title="Programa√ß√£o Interna (PCP)" data-tt-body="Planejamento e Controle da Produ√ß√£o. Respons√°vel pela abertura das Ordens de Produ√ß√£o no SAP PP." data-tt-adr="Integra√ß√£o: SAP PP ‚Üí Kronix via SQS (Event Schema pendente ‚Äî ADR-001)">
          <div class="pnode-icon">üìã</div>
          <div class="pnode-label">Programa√ß√£o Interna (PCP)</div>
          <div class="pnode-tag tag-sap">SAP PP</div>
        </div>
      </div>

      <div class="pipeline-connector"><div class="connector-line"></div><div class="connector-arrow"></div></div>

      <div class="pipeline-stage">
        <div class="pnode op-node" data-tt-title="Abertura das OPs" data-tt-body="Ordens de Produ√ß√£o abertas no SAP disparam o EBR: cada OP tem uma receita associada no Kronix que deve ser executada e registrada." data-tt-adr="ADR-003: Modelo de Dados da Receita ‚Äî OP como entidade raiz do BatchRecord">
          <div class="pnode-icon">üìÇ</div>
          <div class="pnode-label">Abertura das OPs</div>
          <div class="pnode-sub">3 tipos</div>
          <div class="pnode-tag tag-sap">SAP</div>
          <div style="margin-left: 4px; display: inline-block;" class="pnode-tag tag-ebr">EBR</div>
        </div>
      </div>

      <div class="pipeline-connector"><div class="connector-line"></div><div class="connector-arrow"></div></div>

      <div class="pipeline-stage">
        <div class="pnode gxp-node" data-tt-title="Execu√ß√£o com Registro GxP" data-tt-body="Toda execu√ß√£o de receita √© registrada no EBR com assinatura eletr√¥nica, timestamp UTC e audit trail imut√°vel. Escopo principal do Novo EBR." data-tt-adr="ADR-001 v3 ¬∑ ADR-004 v1 ¬∑ ADR-005 (planejado)">
          <div class="pnode-icon">‚öóÔ∏è</div>
          <div class="pnode-label">Execu√ß√£o com Registro GxP</div>
          <div class="pnode-tag tag-ebr">EBR Core</div>
        </div>
      </div>

      <div class="pipeline-connector"><div class="connector-line"></div><div class="connector-arrow"></div></div>

      <div class="pipeline-stage">
        <div class="pnode gq-node" data-tt-title="Libera√ß√£o de Lote (GQ)" data-tt-body="Farmac√™utico respons√°vel revisa o dossi√™ eletr√¥nico do lote e assina eletronicamente a libera√ß√£o. Exige re-autentica√ß√£o (21 CFR Part 11 ¬ß11.200)." data-tt-adr="ADR-005 (planejado): Assinatura Eletr√¥nica e re-autentica√ß√£o">
          <div class="pnode-icon">‚úÖ</div>
          <div class="pnode-label">Libera√ß√£o de Lote (GQ)</div>
          <div class="pnode-sub">Assinatura eletr√¥nica</div>
          <div class="pnode-tag tag-gq">GQ / QA</div>
        </div>
      </div>

      <div class="pipeline-connector"><div class="connector-line"></div><div class="connector-arrow"></div></div>

      <div class="pipeline-stage">
        <div class="pnode sap-node" data-tt-title="Confirma√ß√£o SAP + Almoxarifado" data-tt-body="EBR emite evento de encerramento da OP. SAP MM/PP confirma a ordem e movimenta o estoque de produto acabado. Fechamento do ciclo." data-tt-adr="Integra√ß√£o: Kronix ‚Üí SAP via SQS. Gap identificado: event de confirma√ß√£o de OP n√£o documentado nos ADRs.">
          <div class="pnode-icon">üì¶</div>
          <div class="pnode-label">Confirma√ß√£o SAP + Almoxarifado</div>
          <div class="pnode-tag tag-sap">SAP MM</div>
          <div style="margin-left: 4px; display: inline-block;" class="pnode-tag tag-wms">WMS</div>
        </div>
      </div>

    </div>

    <!-- OPs GRID -->
    <div class="section-divider" style="margin: 16px 0 14px;">
      <span class="section-divider-text">// Ordens de Produ√ß√£o detalhadas</span>
      <div class="section-divider-line"></div>
    </div>

    <div class="ops-grid">

      <!-- OP 70 MANIPULA√á√ÉO -->
      <div class="op-card fade-in">
        <div class="op-header op-header-70">
          <div>
            <div class="op-code op-code-70">OP COD 70</div>
            <div class="op-name">Manipula√ß√£o</div>
          </div>
          <span class="badge badge-fda" style="font-size:8px;">GxP Cr√≠tico</span>
        </div>
        <div class="op-body">
          <div class="op-steps">
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Solicita√ß√£o NT ‚Üí Almoxarifado</div>
                <div class="step-system">SAP MM ¬∑ movimenta√ß√£o de estoque</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-gq"></div>
              <div class="step-content">
                <div class="step-name">Emiss√£o da Documenta√ß√£o (GQ)</div>
                <div class="step-system">GQ emite BPR ¬∑ Produ√ß√£o recebe</div>
              </div>
              <span class="step-badge tag-gq">GQ</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Recebimento do material (via SAP)</div>
                <div class="step-system">Movimenta√ß√£o √°rea classificada</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-evolutio"></div>
              <div class="step-content">
                <div class="step-name">Libera√ß√£o sala de pesagem</div>
                <div class="step-system">Pesagem no Sistema Evolutio</div>
              </div>
              <span class="step-badge tag-evolutio">Evolutio</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Encaminhamento PA + Excipientes</div>
                <div class="step-system">EBR registra handoff pesagem ‚Üí manipula√ß√£o</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Libera√ß√£o da Sala ¬∑ Recebimento materiais</div>
                <div class="step-system">Line clearance ‚Üí EBR registra com assinatura</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Adi√ß√£o no Reator + Pr√©-Filtra√ß√£o</div>
                <div class="step-system">Par√¢metros registrados no EBR com IoT</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
          </div>
        </div>
      </div>

      <!-- OP 77 ENVASE -->
      <div class="op-card fade-in">
        <div class="op-header op-header-77">
          <div>
            <div class="op-code op-code-77">OP COD 77</div>
            <div class="op-name">Envase</div>
          </div>
          <span class="badge badge-fda" style="font-size:8px;">GxP Cr√≠tico</span>
        </div>
        <div class="op-body">
          <div class="op-steps">
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Abastecimento Carpule / Nest (Ber√ßo)</div>
                <div class="step-system">Movimenta√ß√£o material Carpule</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Solicita√ß√£o NT ‚Üí Almoxarifado</div>
                <div class="step-system">Separa√ß√£o Selo e Plunger (via SAP)</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Libera√ß√£o de Sala</div>
                <div class="step-system">Line clearance com assinatura GQ</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Transfer√™ncia do Material ‚Üí Envase</div>
                <div class="step-system">EBR registra transfer√™ncia com rastreabilidade</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Transfer√™ncia do Carpule</div>
                <div class="step-system">Par√¢metros de envase registrados</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Inspe√ß√£o Visual</div>
                <div class="step-system">Formul√°rio estruturado ¬∑ crit√©rios AQL</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
          </div>
        </div>
      </div>

      <!-- OP MONTAGEM C√ÇNULA -->
      <div class="op-card fade-in">
        <div class="op-header op-header-montagem">
          <div>
            <div class="op-code op-code-montagem">OP COD 77 GMS / 13</div>
            <div class="op-name">Montagem da C√¢nula</div>
          </div>
          <span style="font-size:8px;" class="badge" style="background:var(--orange-dim);border-color:rgba(247,127,0,0.3);color:var(--orange);">WMS Boundary</span>
        </div>
        <div class="op-body">
          <div class="op-steps">
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Solicita√ß√£o NT ‚Üí Almoxarifado</div>
                <div class="step-system">Separa√ß√£o de material (via SAP)</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Recebimento (via SAP) ‚Üí Libera√ß√£o do Lote</div>
                <div class="step-system">Confer√™ncia de material recebido</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Abastecimento da M√°quina</div>
                <div class="step-system">Par√¢metros de setup registrados no EBR</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-ebr"></div>
              <div class="step-content">
                <div class="step-name">Montagem + Rotulagem</div>
                <div class="step-system">EBR registra opera√ß√£o com rastreabilidade</div>
              </div>
              <span class="step-badge tag-ebr">EBR</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-wms"></div>
              <div class="step-content">
                <div class="step-name">Transfer√™ncia para Almoxarifado</div>
                <div class="step-system">EBR emite evento ‚Üí SAP confirma OP</div>
              </div>
              <span class="step-badge tag-wms">WMS/SAP</span>
            </div>
            <div class="op-step">
              <div class="step-dot dot-sap"></div>
              <div class="step-content">
                <div class="step-name">Devolu√ß√£o de Material</div>
                <div class="step-system">SAP MM ¬∑ fechamento de ordem</div>
              </div>
              <span class="step-badge tag-sap">SAP</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ======== LAYER 2: ARCHITECTURE ======== -->
  <div class="section-divider fade-in">
    <span class="section-divider-text">// Camada 2 ‚Äî Arquitetura de Sistemas</span>
    <div class="section-divider-line"></div>
    <span class="badge badge-gxp" style="font-size:9px;">AWS Cloud ¬∑ EKS/ECS ¬∑ Multi-Tenant</span>
  </div>

  <div class="arch-layer fade-in">
    <div class="process-title">Stack T√©cnico ‚Äî Kronix EBR ¬∑ ADR-001 v3 / ADR-004 v1</div>

    <div class="arch-grid">

      <!-- LEFT: EXTERNAL SYSTEMS -->
      <div style="display:flex;flex-direction:column;gap:10px;">

        <div style="font-size:9px;font-family:'IBM Plex Mono',monospace;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);margin-bottom:4px;">Sistemas Externos</div>

        <div class="sys-box" style="border-color:rgba(41,160,90,0.35);" data-tt-title="SAP (ECC)" data-tt-body="Sistema ERP do Grupo NC. PP: Ordens de Produ√ß√£o. MM: Movimenta√ß√£o de estoque/NT. SD: Demanda comercial. Integra√ß√£o bidirecional com Kronix via Amazon SQS/SNS." data-tt-adr="ADR-001: SQS/SNS j√° em produ√ß√£o para OEE e Heijunka. Event Schema pendente de defini√ß√£o.">
          <div class="sys-box-header" style="background:rgba(41,160,90,0.08);border-bottom:1px solid rgba(41,160,90,0.2);">
            <div class="sys-icon" style="background:rgba(41,160,90,0.15);">üè¢</div>
            <div>
              <div class="sys-name">SAP ECC</div>
              <div class="sys-role">PP / MM / SD</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>OPs:</strong> dispara receita no EBR</div>
            <div class="sys-detail"><strong>NT:</strong> movimenta√ß√£o materiais</div>
            <div class="sys-detail"><strong>MM:</strong> confirma√ß√£o de ordem</div>
          </div>
        </div>

        <div class="sys-box" style="border-color:rgba(167,139,250,0.35);" data-tt-title="Sistema Evolutio (Pesagem)" data-tt-body="Sistema especializado de pesagem farmac√™utica. Gera registros de pesagem com rastreabilidade (etiquetas, laudos). Gap cr√≠tico: integra√ß√£o com EBR n√£o documentada nos ADRs." data-tt-adr="‚ö† GAP: Evolutio tem API? Como o EBR consome dados de pesagem? Quem √© fonte da verdade?">
          <div class="sys-box-header" style="background:rgba(167,139,250,0.08);border-bottom:1px solid rgba(167,139,250,0.2);">
            <div class="sys-icon" style="background:rgba(167,139,250,0.15);">‚öñÔ∏è</div>
            <div>
              <div class="sys-name">Evolutio</div>
              <div class="sys-role">Sistema de Pesagem</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>Usado em:</strong> OP 70 Pesagem</div>
            <div class="sys-detail"><strong>Dado:</strong> peso, lote, operador</div>
            <div class="sys-detail" style="color:var(--gold);">‚ö† Integra√ß√£o a definir</div>
          </div>
        </div>

        <div class="sys-box" data-tt-title="SSO / SAML (Identidade)" data-tt-body="Infraestrutura de identidade existente no Grupo NC. EBR herda sem criar nova infraestrutura. Exp√µe claims de usu√°rio, role, tenant_id para o Audit Trail." data-tt-adr="ADR-005 (planejado): Re-autentica√ß√£o 21 CFR Part 11 ¬ß11.200(d)(1). Confirmar: SSO exp√µe tenant_id como claim?">
          <div class="sys-box-header" style="background:rgba(0,180,216,0.06);">
            <div class="sys-icon" style="background:rgba(0,180,216,0.12);">üîë</div>
            <div>
              <div class="sys-name">SSO / SAML</div>
              <div class="sys-role">Identidade Corporativa</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>Herdado</strong> pelo EBR</div>
            <div class="sys-detail"><strong>Claims:</strong> user, role, tenant</div>
            <div class="sys-detail">Bearer Token ‚Üí Audit Trail</div>
          </div>
        </div>

      </div>

      <!-- CENTER: KRONIX CORE -->
      <div class="kronix-core">
        <div class="gxp-boundary"></div>
        <div class="kronix-header">
          <div>
            <div class="kronix-title">KRONIX EBR</div>
            <div class="kronix-sub">ASP.NET Core ¬∑ .NET C# 10 ¬∑ Modular Monolith</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
            <span class="badge badge-gxp" style="font-size:8px;">Fronteira GxP</span>
            <span style="font-size:8px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">EKS/ECS ¬∑ AWS VPC</span>
          </div>
        </div>

        <div class="kronix-body">

          <!-- FRONTEND -->
          <div style="background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:10px 12px;margin-bottom:10px;">
            <div style="font-size:9px;font-family:'IBM Plex Mono',monospace;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;">Frontend</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <div style="background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:7px 10px;flex:1;min-width:120px;cursor:pointer;transition:all 0.2s;" data-tt-title="React + React Flow" data-tt-body="Interface principal do operador. React Flow √© o engine do editor visual de receitas (grafo dirigido). Tamb√©m usado no player de execu√ß√£o ‚Äî operador segue o fluxo da receita em tempo real." data-tt-adr="ADR-003 (planejado): Modelo de Dados da Receita. Receita √© um grafo com condicionais (bifurca√ß√µes), n√£o checklist sequencial.">
                <div style="font-size:10px;font-weight:600;color:var(--text-bright);">React + React Flow</div>
                <div style="font-size:9px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">Editor de receita + Player</div>
              </div>
              <div style="background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:7px 10px;flex:1;min-width:100px;cursor:pointer;transition:all 0.2s;" data-tt-title="Interface Android (Tablets)" data-tt-body="Operadores no ch√£o de f√°brica usam tablets Android. A re-autentica√ß√£o para assinatura eletr√¥nica (21 CFR Part 11) deve ser otimizada para toque em √°rea classificada." data-tt-adr="ADR-005 (planejado): UX de assinatura eletr√¥nica em Android ¬∑ √°rea classificada">
                <div style="font-size:10px;font-weight:600;color:var(--text-bright);">Android (Tablets)</div>
                <div style="font-size:9px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">Ch√£o de f√°brica</div>
              </div>
            </div>
          </div>

          <!-- CORE MODULES -->
          <div style="font-size:9px;font-family:'IBM Plex Mono',monospace;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;">M√≥dulos Core (Monolito Modular)</div>

          <div class="modules-grid">
            <div class="module-card active" data-tt-title="Receita (Recipe Engine)" data-tt-body="Gerencia o ciclo de vida da receita: cria√ß√£o, versionamento, aprova√ß√£o GQ, publica√ß√£o. Cada vers√£o aprovada √© imut√°vel ‚Äî mudan√ßas geram nova vers√£o. Estrutura JSON persistida no PostgreSQL." data-tt-adr="ADR-003 (planejado): Schema da receita, versionamento GxP, representa√ß√£o React Flow ‚Üî .NET">
              <div class="module-name">Receita (Recipe Engine)</div>
              <div class="module-desc">CREATE ¬∑ VERSION ¬∑ APPROVE</div>
            </div>
            <div class="module-card" data-tt-title="Execu√ß√£o de Receita" data-tt-body="Runtime de execu√ß√£o: orquestra o operador passo a passo pelo fluxo da receita. Valida que os passos s√£o executados na ordem correta e registra cada a√ß√£o no Audit Trail." data-tt-adr="Integra√ß√£o s√≠ncrona com Audit Trail Service via HTTPS interno (ADR-004)">
              <div class="module-name">Execu√ß√£o de Receita</div>
              <div class="module-desc">STEP ¬∑ SIGN ¬∑ COMPLETE</div>
            </div>
            <div class="module-card" data-tt-title="Dossi√™ Eletr√¥nico de Lote" data-tt-body="Consolida todos os registros de execu√ß√£o num documento estruturado equivalente ao BPR (Batch Production Record). Gerado para revis√£o de GQ antes da libera√ß√£o do lote." data-tt-adr="ADR-003: Como o Dossi√™ agrega dados de m√∫ltiplas OPs relacionadas ao mesmo lote?">
              <div class="module-name">Dossi√™ de Lote (BPR)</div>
              <div class="module-desc">COMPILE ¬∑ REVIEW ¬∑ RELEASE</div>
            </div>
            <div class="module-card" data-tt-title="Logbook Eletr√¥nico" data-tt-body="Registro de equipamentos, salas e linhas. Conectado √† Libera√ß√£o de Sala (line clearance) ‚Äî cada sala precisa de logbook limpo antes de iniciar a OP." data-tt-adr="Gap: Libera√ß√£o de Sala √© m√≥dulo do EBR? Requer assinatura GQ ‚Äî deve alimentar Audit Trail.">
              <div class="module-name">Logbook Eletr√¥nico</div>
              <div class="module-desc">EQUIPMENT ¬∑ ROOM ¬∑ LINE</div>
            </div>
            <div class="module-card" data-tt-title="Recebimento de OP" data-tt-body="Recebe a OP do SAP via SQS, valida os dados, cria o BatchRecord no Kronix e associa a receita correta. Ponto de entrada do fluxo EBR." data-tt-adr="ADR-001: Event Schema SQS ‚Äî OP aberta no SAP ‚Üí EBR. Pendente defini√ß√£o.">
              <div class="module-name">Recebimento de OP</div>
              <div class="module-desc">SAP ‚Üí EBR TRIGGER</div>
            </div>
            <div class="module-card" data-tt-title="Anexos e Documentos" data-tt-body="Armazenamento de documentos associados ao lote: fotos de processo, laudos externos, desvios registrados. S3 para storage, refer√™ncia no PostgreSQL." data-tt-adr="Armazenamento: Amazon S3 (documentos n√£o regulat√≥rios) ¬∑ separado do S3 Audit Trail (Object Lock)">
              <div class="module-name">Anexos / Documentos</div>
              <div class="module-desc">ATTACH ¬∑ STORE ¬∑ LINK</div>
            </div>
          </div>

          <!-- SHARED INFRA -->
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px;">
            <div style="background:var(--bg2);border:1px solid var(--border);border-radius:5px;padding:7px 10px;text-align:center;cursor:pointer;" data-tt-title="Amazon RDS PostgreSQL" data-tt-body="Banco principal do Core EBR. Multi-AZ, encryption at rest (KMS). Role da aplica√ß√£o: SELECT/INSERT/UPDATE/DELETE no schema core. Separado do banco do Audit Trail Service." data-tt-adr="ADR-001: Decis√£o pendente ‚Äî schema por tenant (RBBL, EMS) ou banco por tenant?">
              <div style="font-size:13px;margin-bottom:3px;">üêò</div>
              <div style="font-size:10px;font-weight:600;color:var(--text-bright);">PostgreSQL</div>
              <div style="font-size:8px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">Amazon RDS ¬∑ Multi-AZ</div>
            </div>
            <div style="background:var(--bg2);border:1px solid var(--border);border-radius:5px;padding:7px 10px;text-align:center;cursor:pointer;" data-tt-title="Redis (Cache Distribu√≠do)" data-tt-body="Substituiu o in-process cache ap√≥s incidente de inconsist√™ncia entre PODs. Cache compartilhado para sess√µes, dados de receita em execu√ß√£o, estado de tela do operador." data-tt-adr="ADR-001: Redis j√° implementado. Definir TTL por tipo de dado e estrat√©gia de invalida√ß√£o.">
              <div style="font-size:13px;margin-bottom:3px;">‚ö°</div>
              <div style="font-size:10px;font-weight:600;color:var(--text-bright);">Redis</div>
              <div style="font-size:8px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">ElastiCache ¬∑ Distribu√≠do</div>
            </div>
            <div style="background:var(--bg2);border:1px solid var(--border);border-radius:5px;padding:7px 10px;text-align:center;cursor:pointer;" data-tt-title="Amazon SQS / SNS" data-tt-body="Mensageria j√° em produ√ß√£o para OEE e Heijunka. EBR herda para integra√ß√µes externas: SAP (OP aberta, confirma√ß√£o MM), LIMS, SE Suite." data-tt-adr="ADR-001: Event Schema SQS obrigat√≥rio antes do primeiro consumer. Versionamento de schema.">
              <div style="font-size:13px;margin-bottom:3px;">üì®</div>
              <div style="font-size:10px;font-weight:600;color:var(--text-bright);">SQS / SNS</div>
              <div style="font-size:8px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">Integra√ß√µes externas</div>
            </div>
          </div>

          <!-- AUDIT TRAIL SERVICE -->
          <div class="audit-service" data-tt-title="Audit Trail Service ‚Äî Microservi√ßo Extra√≠do" data-tt-body="Servi√ßo fisicamente separado do Core EBR. Banco PostgreSQL dedicado com role INSERT-only. S3 Object Lock para reten√ß√£o imut√°vel 5 anos. Comunica√ß√£o s√≠ncrona via HTTPS interno ‚Äî garantia de entrega na mesma opera√ß√£o de neg√≥cio." data-tt-adr="ADR-004 v1 ‚Äî Arquitetura completa documentada. Pode iniciar desenvolvimento ESTA SEMANA.">
            <div class="audit-header">
              <div class="audit-title">
                üîí Audit Trail Service
                <span class="badge badge-gxp" style="font-size:8px;">Microservi√ßo Extra√≠do</span>
              </div>
              <span style="font-size:9px;font-family:'IBM Plex Mono',monospace;color:var(--text-dim);">ADR-004 v1</span>
            </div>
            <div class="audit-body">
              <div class="audit-component">
                <div class="audit-comp-icon">üêò</div>
                <div class="audit-comp-name">RDS Dedicado</div>
                <div class="audit-comp-desc">INSERT only ¬∑ KMS</div>
              </div>
              <div class="audit-component">
                <div class="audit-comp-icon">ü™£</div>
                <div class="audit-comp-name">S3 Object Lock</div>
                <div class="audit-comp-desc">WORM ¬∑ 5 anos</div>
              </div>
              <div class="audit-component">
                <div class="audit-comp-icon">üìä</div>
                <div class="audit-comp-name">Datadog APM</div>
                <div class="audit-comp-desc">Tracing ¬∑ Alertas</div>
              </div>
            </div>
          </div>

          <!-- AWS INFRA -->
          <div class="aws-infra">
            <div class="aws-title">‚òÅ AWS Infraestrutura</div>
            <div class="aws-services">
              <span class="aws-chip" data-tt-title="EKS / ECS" data-tt-body="Orquestrador de containers. EKS (Kubernetes) ou ECS (nativo AWS). Decis√£o pendente com Marcelo Ramos ‚Äî define manifesto de deploy do Audit Trail Service." data-tt-adr="ADR-001: Pergunta em aberto #1. Bloqueador para arquitetura de containers.">‚öôÔ∏è EKS / ECS</span>
              <span class="aws-chip" data-tt-title="Secrets Manager" data-tt-body="Gest√£o de credenciais ‚Äî connection strings RDS, tokens de servi√ßo. Rota√ß√£o autom√°tica a cada 30 dias. Zero credencial hardcoded." data-tt-adr="ADR-004: Proposto. Implementar desde o primeiro deploy.">üîê Secrets Manager</span>
              <span class="aws-chip" data-tt-title="CloudTrail" data-tt-body="Auditoria de acesso √† infraestrutura AWS. Quem acessou qual recurso AWS e quando. Complementa o Audit Trail de aplica√ß√£o." data-tt-adr="ADR-004: Proposto como complemento ao Audit Trail de aplica√ß√£o.">üìã CloudTrail</span>
              <span class="aws-chip" data-tt-title="KMS" data-tt-body="Encryption at rest para RDS (Core + Audit Trail) e S3. Chaves gerenciadas com rota√ß√£o autom√°tica." data-tt-adr="">üîë KMS</span>
              <span class="aws-chip" data-tt-title="AWS Config" data-tt-body="Regras de conformidade que alertam se Security Groups forem modificados fora do padr√£o definido. Prote√ß√£o contra bypass da rede de isolamento do Audit Trail." data-tt-adr="ADR-004: Regra de conformidade obrigat√≥ria.">‚úÖ AWS Config</span>
              <span class="aws-chip" data-tt-title="Kafka / MSK (Nice-to-Have)" data-tt-body="Pipeline IoT para sensores de processo. Condicional ao volume real de eventos por linha de produ√ß√£o confirmado no Discovery AS-IS. Crit√©rio: > 50 eventos/s ou > 3 linhas simult√¢neas." data-tt-adr="ADR-001: Condicional. Crit√©rio de ativa√ß√£o expl√≠cito. Fallback: SQS.">üì° MSK/Kafka ‚ö†</span>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT: OBSERVABILITY + ADJACENT -->
      <div style="display:flex;flex-direction:column;gap:10px;">

        <div style="font-size:9px;font-family:'IBM Plex Mono',monospace;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);margin-bottom:4px;">Observabilidade & Adjacentes</div>

        <div class="sys-box" style="border-color:rgba(255,145,0,0.35);" data-tt-title="Datadog APM" data-tt-body="Observabilidade unificada ‚Äî APM, logs centralizados, tracing distribu√≠do Core EBR ‚Üí Audit Trail. Dashboard GxP: volume eventos por m√≥dulo/tenant. Alerta cr√≠tico: falha escrita Audit Trail = n√£o-conformidade GxP." data-tt-adr="ADR-004: Alertas cr√≠ticos obrigat√≥rios desde o primeiro deploy. Confirmar: Datadog j√° licenciado no Grupo NC?">
          <div class="sys-box-header" style="background:rgba(255,145,0,0.08);border-bottom:1px solid rgba(255,145,0,0.2);">
            <div class="sys-icon" style="background:rgba(255,145,0,0.15);">üìä</div>
            <div>
              <div class="sys-name">Datadog</div>
              <div class="sys-role">APM ¬∑ Logs ¬∑ Tracing</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>Tracing:</strong> Core ‚Üí Audit Trail</div>
            <div class="sys-detail"><strong>Alerta:</strong> &gt;0% erro escrita</div>
            <div class="sys-detail"><strong>Dashboard:</strong> GxP compliance</div>
          </div>
        </div>

        <div class="sys-box" data-tt-title="Kronix ‚Äî M√≥dulos Existentes" data-tt-body="OEE (Overall Equipment Effectiveness) e Heijunka j√° est√£o em produ√ß√£o na plataforma Kronix. EBR √© o terceiro m√≥dulo. Redis e SQS/SNS j√° foram adotados nesses m√≥dulos ‚Äî EBR herda a infraestrutura." data-tt-adr="ADR-001: Verificar se Audit Trail do OEE/Heijunka usa padr√£o que o EBR deve herdar.">
          <div class="sys-box-header" style="background:rgba(0,180,216,0.06);">
            <div class="sys-icon" style="background:rgba(0,180,216,0.12);">üè≠</div>
            <div>
              <div class="sys-name">Kronix (existente)</div>
              <div class="sys-role">OEE ¬∑ Heijunka</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>Redis:</strong> herdado ‚Üí EBR</div>
            <div class="sys-detail"><strong>SQS/SNS:</strong> herdado ‚Üí EBR</div>
            <div class="sys-detail">Roadmap: MFV ¬∑ IoT</div>
          </div>
        </div>

        <div class="sys-box" style="border-color:rgba(255,214,10,0.3);" data-tt-title="GQ / QA (Stakeholder)" data-tt-body="Daiane Onida (GQ EMS) e Juliana Zendim (VSC). Revisam e aprovam: schema do Audit Trail, casos de teste de imutabilidade, protocolo VSC (IQ/OQ/PQ). Audi√™ncia da API read-only do Audit Trail." data-tt-adr="ADR-004: Apresentar schema e contrato de API para GQ antes de codar o cliente. A√ß√£o imediata.">
          <div class="sys-box-header" style="background:rgba(255,214,10,0.06);border-bottom:1px solid rgba(255,214,10,0.15);">
            <div class="sys-icon" style="background:rgba(255,214,10,0.12);">üî¨</div>
            <div>
              <div class="sys-name">GQ / VSC</div>
              <div class="sys-role">Quality Assurance</div>
            </div>
          </div>
          <div class="sys-body">
            <div class="sys-detail"><strong>Daiane:</strong> GQ EMS</div>
            <div class="sys-detail"><strong>Juliana:</strong> VSC (IQ/OQ/PQ)</div>
            <div class="sys-detail">Revisar ADR-004 urgente</div>
          </div>
        </div>

      </div>
    </div>

    <!-- INTEGRATIONS -->
    <div class="section-divider" style="margin: 20px 0 14px;">
      <span class="section-divider-text">// Integra√ß√µes ‚Äî Event Contracts</span>
      <div class="section-divider-line"></div>
    </div>

    <div class="integrations-row">
      <div class="integration-card" data-tt-title="SAP ‚Üí Kronix: OP Aberta" data-tt-body="SAP PP publica evento de abertura de OP. Kronix consome via SQS, valida, cria BatchRecord e associa receita. Ponto de entrada do fluxo EBR." data-tt-adr="ADR-001: Event Schema SQS pendente de defini√ß√£o. Campos m√≠nimos: OP number, material, quantidade, data prevista, receita associada.">
        <div class="int-header">
          <div class="int-dot" style="background:var(--sap-light);"></div>
          <div class="int-name">SAP ‚Üí Kronix</div>
          <div class="int-protocol">SQS</div>
        </div>
        <div class="int-detail">OP aberta dispara cria√ß√£o de BatchRecord. Receita associada pelo c√≥digo do material.</div>
      </div>
      <div class="integration-card" data-tt-title="Kronix ‚Üí Audit Trail: Evento de Auditoria" data-tt-body="Chamada HTTPS s√≠ncrona. Core EBR posta evento a cada a√ß√£o significativa. Idempotency Key obrigat√≥rio. Resposta 201 ou 503 ‚Äî sem retry silencioso em GxP." data-tt-adr="ADR-004: Contrato POST /api/v1/audit/events documentado. Iniciar implementa√ß√£o esta semana.">
        <div class="int-header">
          <div class="int-dot" style="background:var(--red);"></div>
          <div class="int-name">Core EBR ‚Üí Audit Trail</div>
          <div class="int-protocol">HTTPS VPC</div>
        </div>
        <div class="int-detail">S√≠ncrono ¬∑ Bearer Token SSO ¬∑ Idempotency Key UUID ¬∑ INSERT-only RDS dedicado.</div>
      </div>
      <div class="integration-card" data-tt-title="Kronix ‚Üí SAP: Confirma√ß√£o de OP" data-tt-body="Ao fechar o Dossi√™ de Lote, EBR emite evento de encerramento para SAP confirmar a ordem (MM/PP). SAP movimenta estoque de produto acabado. Gap: n√£o documentado nos ADRs atuais." data-tt-adr="‚ö† GAP: Event de confirma√ß√£o de OP (EBR ‚Üí SAP) n√£o est√° nos ADRs. Adicionar ao ADR-001.">
        <div class="int-header">
          <div class="int-dot" style="background:var(--sap-light);"></div>
          <div class="int-name">Kronix ‚Üí SAP</div>
          <div class="int-protocol">SQS</div>
        </div>
        <div class="int-detail">Confirma√ß√£o de OP encerrada. SAP confirma ordem e movimenta PA para Almoxarifado.</div>
      </div>
      <div class="integration-card" data-tt-title="Evolutio ‚Üí Kronix: Dados de Pesagem" data-tt-body="Gap cr√≠tico: Evolutio √© sistema de pesagem com dados de rastreabilidade do lote (PA + excipientes). EBR precisa consumir ou referenciar esses dados. Integra√ß√£o n√£o documentada nos ADRs." data-tt-adr="‚ö† GAP CR√çTICO: Levantar no Discovery com Gustavo Fontes. Evolutio tem API? Webservice? Arquivo? Impacta schema audit_events (actor_id sist√™mico).">
        <div class="int-header">
          <div class="int-dot" style="background:var(--evolutio-light);"></div>
          <div class="int-name">Evolutio ‚Üí Kronix</div>
          <div class="int-protocol">‚ö† A DEFINIR</div>
        </div>
        <div class="int-detail">Dados de pesagem (PA + excipientes). Protocolo de integra√ß√£o n√£o confirmado. Levantar no Discovery.</div>
      </div>
      <div class="integration-card" data-tt-title="GQ ‚Üí Audit Trail: API Read-Only" data-tt-body="Daiane Onida e auditores ANVISA/FDA consultam o Audit Trail via API read-only. Autentica√ß√£o SSO/SAML com role GQ. Cada acesso registrado no CloudWatch Logs." data-tt-adr="ADR-004: Endpoints GET documentados. Pagina√ß√£o obrigat√≥ria (max 100/p√°gina). Acesso logado.">
        <div class="int-header">
          <div class="int-dot" style="background:var(--gold);"></div>
          <div class="int-name">GQ ‚Üí Audit Trail</div>
          <div class="int-protocol">HTTPS</div>
        </div>
        <div class="int-detail">API read-only para GQ e auditorias ANVISA/FDA. Role GQ via SSO. CloudWatch log de cada acesso.</div>
      </div>
      <div class="integration-card" data-tt-title="Core EBR ‚Üí S3 (Documentos)" data-tt-body="Anexos n√£o regulat√≥rios: fotos de processo, laudos externos, desvios. S3 padr√£o (sem Object Lock). Separado do S3 do Audit Trail que usa Object Lock modo Compliance." data-tt-adr="Dois buckets S3 distintos: (1) Documentos EBR ‚Äî S3 padr√£o. (2) Audit Trail backup ‚Äî S3 Object Lock WORM 5 anos.">
        <div class="int-header">
          <div class="int-dot" style="background:var(--orange);"></div>
          <div class="int-name">Core EBR ‚Üí S3</div>
          <div class="int-protocol">AWS SDK</div>
        </div>
        <div class="int-detail">Documentos do dossi√™ (n√£o regulat√≥rios). Separado do S3 Object Lock do Audit Trail.</div>
      </div>
    </div>

  </div>

  <!-- LEGEND -->
  <div class="legend fade-in" style="margin-top:16px;">
    <div style="font-size:9px;font-family:'IBM Plex Mono',monospace;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-right:8px;">Legenda:</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--accent);"></div>EBR Core</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--sap-light);"></div>SAP</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--evolutio-light);"></div>Evolutio</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--gold);"></div>GQ / QA</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--orange);"></div>WMS / Almoxarifado</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--red);"></div>Audit Trail (GxP)</div>
    <div class="legend-item"><div class="legend-dashed"></div>Fronteira GxP regulat√≥ria</div>
    <div class="legend-item" style="margin-left:auto;"><span class="gap-indicator">‚ö† GAP</span> = n√£o documentado nos ADRs</div>
    <div class="legend-item" style="font-size:9px;color:var(--text-dim);">Hover nos elementos para detalhes</div>
  </div>

</div>

<script>
  const tooltip = document.getElementById('tooltip');
  const ttTitle = document.getElementById('tt-title');
  const ttBody = document.getElementById('tt-body');
  const ttAdr = document.getElementById('tt-adr');

  document.querySelectorAll('[data-tt-title]').forEach(el => {
    el.addEventListener('mouseenter', (e) => {
      const title = el.getAttribute('data-tt-title');
      const body = el.getAttribute('data-tt-body');
      const adr = el.getAttribute('data-tt-adr');
      if (!title) return;
      ttTitle.textContent = title;
      ttBody.textContent = body || '';
      ttAdr.textContent = adr || '';
      tooltip.classList.add('visible');
      positionTooltip(e);
    });

    el.addEventListener('mousemove', positionTooltip);

    el.addEventListener('mouseleave', () => {
      tooltip.classList.remove('visible');
    });
  });

  function positionTooltip(e) {
    const x = e.clientX + 14;
    const y = e.clientY - 10;
    const rect = tooltip.getBoundingClientRect();
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    tooltip.style.left = (x + rect.width > vw ? e.clientX - rect.width - 14 : x) + 'px';
    tooltip.style.top = (y + rect.height > vh ? e.clientY - rect.height - 10 : y) + 'px';
  }
</script>

</body>
</html>
