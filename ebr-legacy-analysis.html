<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An√°lise do Banco Legado EBR EMS ‚Äî Insumos para Kronix EBR</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; color: #222; font-size: 14px; }

  header {
    background: linear-gradient(135deg, #1a2744 0%, #2d4a8a 100%);
    color: white; padding: 28px 40px 22px;
    border-bottom: 4px solid #4a90d9;
  }
  header h1 { font-size: 22px; font-weight: 700; letter-spacing: 0.3px; }
  header .meta { font-size: 12px; opacity: 0.75; margin-top: 6px; }
  header .badge {
    display: inline-block; background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3); border-radius: 4px;
    padding: 3px 10px; font-size: 11px; margin-top: 10px; margin-right: 8px;
  }
  header .badge.v2 { background: rgba(74,200,100,0.25); border-color: rgba(74,200,100,0.5); }

  nav {
    background: #fff; border-bottom: 1px solid #dde3f0;
    padding: 0 40px; display: flex; gap: 0; position: sticky; top: 0; z-index: 100;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06); flex-wrap: wrap;
  }
  nav a {
    padding: 14px 16px; font-size: 12px; font-weight: 600; color: #555;
    text-decoration: none; border-bottom: 3px solid transparent;
    transition: all 0.2s; white-space: nowrap;
  }
  nav a:hover { color: #2d4a8a; background: #f0f4ff; }
  nav a.active { color: #2d4a8a; border-bottom-color: #2d4a8a; }

  main { max-width: 1200px; margin: 0 auto; padding: 32px 40px 60px; }

  section { margin-bottom: 48px; }
  section h2 {
    font-size: 18px; font-weight: 700; color: #1a2744;
    padding-bottom: 10px; border-bottom: 2px solid #dde3f0; margin-bottom: 20px;
    display: flex; align-items: center; gap: 10px;
  }
  section h2 .icon { font-size: 20px; }
  section h3 {
    font-size: 14px; font-weight: 700; color: #2d4a8a;
    margin: 24px 0 10px; text-transform: uppercase; letter-spacing: 0.5px;
  }

  .summary-grid {
    display: grid; grid-template-columns: repeat(5, 1fr); gap: 14px; margin-bottom: 32px;
  }
  .summary-card {
    background: white; border-radius: 8px; padding: 18px;
    border: 1px solid #dde3f0; text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  }
  .summary-card .number { font-size: 32px; font-weight: 800; color: #2d4a8a; line-height: 1; }
  .summary-card .label { font-size: 11px; color: #666; margin-top: 6px; line-height: 1.4; }
  .summary-card.warn .number { color: #e07b00; }
  .summary-card.danger .number { color: #c0392b; }
  .summary-card.ok .number { color: #1a7a4a; }

  .table-card {
    background: white; border-radius: 8px; padding: 20px 24px;
    border: 1px solid #dde3f0; margin-bottom: 14px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
  }
  .table-card h4 {
    font-family: 'Courier New', monospace; font-size: 13px; font-weight: 700;
    color: #1a2744; margin-bottom: 8px;
  }
  .table-card p { font-size: 13px; color: #444; line-height: 1.6; }
  .table-card .cols { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }
  .table-card .col-tag {
    background: #f0f4ff; border: 1px solid #c8d8f0; border-radius: 3px;
    padding: 2px 7px; font-family: 'Courier New', monospace; font-size: 11px; color: #2d4a8a;
  }
  .table-card .col-tag.pk { background: #fff3cd; border-color: #f0c040; color: #856404; }
  .table-card .col-tag.fk { background: #e8f5e9; border-color: #81c784; color: #2e7d32; }
  .table-card .col-tag.audit { background: #fce4ec; border-color: #f48fb1; color: #880e4f; }
  .table-card .col-tag.key { background: #ede7f6; border-color: #b39ddb; color: #4527a0; font-weight: 700; }
  .table-card .col-tag.new { background: #e8f5e9; border-color: #66bb6a; color: #1b5e20; font-weight: 700; }

  .relation-diagram {
    background: #f8f9ff; border: 1px solid #dde3f0; border-radius: 8px;
    padding: 20px 24px; margin: 16px 0; font-family: 'Courier New', monospace; font-size: 12px;
    line-height: 2;
  }
  .relation-diagram .entity { color: #1a2744; font-weight: 700; }
  .relation-diagram .arrow { color: #2d4a8a; }
  .relation-diagram .note { color: #888; font-style: italic; font-family: 'Segoe UI', sans-serif; }

  .insight {
    border-radius: 6px; padding: 14px 18px; margin: 16px 0;
    border-left: 4px solid; font-size: 13px; line-height: 1.65;
  }
  .insight.blue { background: #e8f0fe; border-color: #2d4a8a; color: #1a2744; }
  .insight.orange { background: #fff3e0; border-color: #e07b00; color: #5a3200; }
  .insight.red { background: #fdecea; border-color: #c0392b; color: #6b1a14; }
  .insight.green { background: #e8f5e9; border-color: #1a7a4a; color: #0d3d24; }
  .insight.purple { background: #f3e5f5; border-color: #7b1fa2; color: #3d0060; }
  .insight strong { font-weight: 700; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  .ref-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .ref-table th {
    background: #1a2744; color: white; padding: 10px 14px;
    text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .ref-table td { padding: 9px 14px; border-bottom: 1px solid #eef0f7; vertical-align: top; }
  .ref-table tr:hover td { background: #f5f7ff; }
  .ref-table code { font-family: 'Courier New'; font-size: 12px; background: #f0f4ff; padding: 1px 5px; border-radius: 3px; }

  .pill {
    display: inline-block; border-radius: 12px; padding: 2px 10px;
    font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px;
  }
  .pill.wave1 { background: #e3f2fd; color: #1565c0; }
  .pill.future { background: #f3e5f5; color: #6a1b9a; }
  .pill.new { background: #e8f5e9; color: #1b5e20; }
  .pill.gap { background: #fce4ec; color: #880e4f; }
  .pill.shared { background: #fff8e1; color: #f57f17; }
  .pill.risk { background: #fdecea; color: #b71c1c; }
  .pill.updated { background: #e0f7fa; color: #006064; }

  .gap-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .gap-table th {
    background: #2d3748; color: white; padding: 10px 14px;
    text-align: left; font-size: 12px;
  }
  .gap-table td { padding: 9px 14px; border-bottom: 1px solid #eef0f7; vertical-align: top; line-height: 1.55; }
  .gap-table tr:hover td { background: #f9f9ff; }
  .gap-table tr.new-row td { background: #f0faf0; }
  .gap-table tr.new-row:hover td { background: #e4f5e4; }

  .subsystem-box {
    background: white; border: 1px solid #dde3f0; border-radius: 8px;
    margin-bottom: 14px; overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
  }
  .subsystem-header {
    background: #f0f4ff; padding: 12px 20px; border-bottom: 1px solid #dde3f0;
    display: flex; align-items: center; gap: 10px;
  }
  .subsystem-header h4 {
    font-family: 'Courier New', monospace; font-size: 13px; font-weight: 700; color: #1a2744;
  }
  .subsystem-header .count { font-size: 11px; color: #666; margin-left: auto; }
  .subsystem-body { padding: 16px 20px; font-size: 13px; color: #444; line-height: 1.6; }
  .subsystem-body .cols { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; }

  .section-nav { scroll-margin-top: 60px; }

  footer {
    background: #1a2744; color: rgba(255,255,255,0.5);
    text-align: center; padding: 18px; font-size: 12px; line-height: 1.8;
  }

  .v2-badge {
    display: inline-block; background: #1a7a4a; color: white;
    border-radius: 4px; padding: 2px 8px; font-size: 10px; font-weight: 700;
    vertical-align: middle; margin-left: 8px; letter-spacing: 0.5px;
  }
</style>
</head>
<body>

<header>
  <h1>An√°lise do Banco Legado EBR EMS ‚Äî Insumos para Kronix EBR <span style="font-size:14px;opacity:0.7">v2.0</span></h1>
  <div class="meta">Fonte: FDBs.graphml ‚Äî Diagrama yEd exportado do banco SAP MII | Kronix EBR Wave 1 ¬∑ Go Live dez/2026 | Double-check completo executado ‚Äî fev/2026</div>
  <span class="badge">598 tabelas totais no GraphML</span>
  <span class="badge">431 tabelas FDB analisadas</span>
  <span class="badge">128 tabelas com FK CD_ORDEM_PRODU</span>
  <span class="badge v2">‚úì v2.0 ‚Äî Double-check completo ¬∑ Subsistemas corrigidos</span>
  <span class="badge">‚ö† Hip√≥teses sinalizadas ‚Äî validar com Gustavo Fontes / √°rea de Qualidade</span>
</header>

<nav>
  <a href="#resumo" class="active">Resumo</a>
  <a href="#modelo-core">Modelo Core</a>
  <a href="#subsistemas">Subsistemas Completos</a>
  <a href="#audit-legado">Audit Trail</a>
  <a href="#shared-ref">Shared Reference DB</a>
  <a href="#gap-analysis">Gap Analysis</a>
  <a href="#migracao">Migra√ß√£o</a>
</nav>

<main>

<!-- RESUMO EXECUTIVO -->
<section id="resumo" class="section-nav">
  <h2><span class="icon">üìä</span> Resumo Executivo</h2>

  <div class="summary-grid">
    <div class="summary-card">
      <div class="number">598</div>
      <div class="label">Tabelas totais no GraphML (FDBs.graphml)</div>
    </div>
    <div class="summary-card">
      <div class="number">431</div>
      <div class="label">Tabelas FDB (prefixo EBR/MES)</div>
    </div>
    <div class="summary-card">
      <div class="number">128</div>
      <div class="label">Tabelas com FK CD_ORDEM_PRODU (OP-linked)</div>
    </div>
    <div class="summary-card warn">
      <div class="number">16</div>
      <div class="label">Gaps identificados no design atual <span style="font-size:10px;display:block;color:#e07b00">+4 vs v1</span></div>
    </div>
    <div class="summary-card ok">
      <div class="number">18</div>
      <div class="label">Candidatos ao Shared Reference DB</div>
    </div>
  </div>

  <div class="insight blue">
    <strong>O legado √© uma plataforma MES completa, n√£o um EBR simples.</strong> O prefixo FDB cobre 431 tabelas incluindo receita, execu√ß√£o, dossi√™, logbook, Audit Trail, amostras, controle de ponto (Absente√≠smo), PCO (Process Control), folha de trabalho por turno, reconcilia√ß√£o de lote, hold time de processo, rastreabilidade de volumes e containers, e integra√ß√£o SAP bidirecional. A migra√ß√£o para o Kronix EBR √© de alta complexidade ‚Äî o escopo vai muito al√©m do que est√° mapeado nos m√≥dulos Wave 1.
  </div>

  <div class="insight orange">
    <strong>Aten√ß√£o: o Audit Trail do legado tem arquitetura completamente diferente da proposta para o Kronix EBR.</strong> O legado usa <code>FDB_AUDIT</code> com granularidade de <em>campo</em> (TRAIL_ID, TABELA, CAMPO, VALOR_ANTES, VALOR_DEPOIS) ‚Äî uma linha por campo alterado. O design proposto para o Kronix usa JSONB (before_state / after_state por entidade inteira). S√£o estrat√©gias distintas com implica√ß√µes para migra√ß√£o hist√≥rica. Detalhe na se√ß√£o Audit Trail.
  </div>

  <div class="insight red">
    <strong>Hold Time √© um subsistema, n√£o um campo.</strong> A an√°lise v1 identificava apenas <code>FDB_HT_PROCESSO</code>. O GraphML revela 5+ tabelas de Hold Time com thresholds m√∫ltiplos (50%, 100%, CK) calculados por fase, por semiacabado e por volume de container. Hold Time e Reconcilia√ß√£o de Lote s√£o os dois gaps com maior risco para o Go Live dez/2026 ‚Äî ambos precisam de valida√ß√£o com Gustavo Fontes antes de fechar o escopo Wave 1.
  </div>

  <div class="insight purple">
    <strong>Novo achado v2: Folha de Trabalho por Turno.</strong> O legado tem um subsistema completo de <code>FDB_FOLHA_TRABALHO</code> com registro de turno por opera√ß√£o, equipe de trabalho e ocorr√™ncias. A tabela <code>FDB_FOLHA_TRABALHO_EQUIPE</code> registra <code>HABILIDADE</code> por operador ‚Äî confirmando que habilidade por operador √© um campo regulat√≥rio rastreado no legado, n√£o apenas uma feature futura.
  </div>
</section>

<!-- MODELO CORE -->
<section id="modelo-core" class="section-nav">
  <h2><span class="icon">üèóÔ∏è</span> Modelo de Dados Core ‚Äî Receita, Execu√ß√£o e Dossi√™</h2>

  <h3>1. Entidade Central: Ordem de Produ√ß√£o</h3>
  <p style="margin-bottom:12px; color:#444; line-height:1.65;">Tudo no legado gira em torno de <code>CD_ORDEM_PRODU</code>. Esta chave aparece em 128 das 431 tabelas FDB (~30% com FK direta; ~80% indiretamente). N√£o existe um conceito de "receita" desacoplado da ordem ‚Äî a receita <strong>√© executada no contexto da OP</strong>.</p>

  <div class="table-card">
    <h4>FDB_ORDEM_PRODUCAO ‚Äî Tabela raiz do modelo (59 colunas)</h4>
    <p>Cont√©m a ordem de produ√ß√£o com dados de planejamento SAP, status de aprova√ß√£o tri-etapas (Produ√ß√£o, Controle de Qualidade, Libera√ß√£o), fluxo de corre√ß√£o GxP, campos de retrabalho, flags de ciclo de vida e configura√ß√µes de etiqueta. √â o agregado raiz ‚Äî tudo se relaciona a ela via <code>CD_ORDEM_PRODU</code>.</p>
    <div class="cols">
      <span class="col-tag pk">CD_ORDEM_PRODU (PK)</span>
      <span class="col-tag key">CD_MATER</span>
      <span class="col-tag key">CD_LOTE</span>
      <span class="col-tag key">CD_STATUS</span>
      <span class="col-tag">DT_PLANE_INICI / DT_PLANE_FIM</span>
      <span class="col-tag">DT_INICI_REAL / DT_ENCER / CD_USER_ENCER</span>
      <span class="col-tag audit">DATA_APROV_PRODU / USUAR_APROV_PRODU / CD_STATU_DOSSI_PRODU</span>
      <span class="col-tag audit">DATA_APROV_CQ / USUAR_APROV_CQ / CD_STATU_DOSSI_CQ</span>
      <span class="col-tag audit">DATA_APROV_LIBER / USUAR_APROV_LIBER / CD_STATU_DOSSI_LIBER</span>
      <span class="col-tag">FL_CORRECAO / FL_CORRIGIDO / CD_FLUXO_SET_CORRECAO</span>
      <span class="col-tag">VERSAO_PROD / NUM_GRP / ULT_NR_ECM</span>
      <span class="col-tag">FL_CANCELADA / CD_LOTE_CANCELADA</span>
      <span class="col-tag new">CD_STATUS_RETRABALHO / DT_STATUS_RETRABALHO / CD_USER_RETRABALHO</span>
      <span class="col-tag new">CK_GRP_SBGRP_DESATIVADO / FL_FINALIZADA / CD_FASE_FINALIZADA</span>
      <span class="col-tag new">CD_USER_CONFE_PRD / TP_CONFE_PRD</span>
      <span class="col-tag new">FL_ETIQ_ENT_OPER_DESAT / USER_ETIQ_ENT_OPER_DESAT / DT_ETIQ_ENT_OPER_DESAT</span>
      <span class="col-tag new">FL_USAR_LT_DM</span>
      <span class="col-tag audit">INSERT_USER / UPDATE_USER / INSERT_TIMESTAMP / UPDATE_TIMESTAMP</span>
    </div>
  </div>

  <div class="insight blue">
    <strong>Insight arquitetural:</strong> O legado tem 3 est√°gios de aprova√ß√£o embutidos na pr√≥pria tabela da OP (PRODU, CQ, LIBER) ‚Äî cada um com data, usu√°rio e status de dossi√™ inline. No Kronix EBR, o design do BPR (Dossi√™) precisa refletir esse fluxo tri-etapas. N√£o √© apenas "aprova√ß√£o GQ" ‚Äî s√£o tr√™s assinaturas distintas com pap√©is, timestamps e status de dossi√™ separados.
  </div>

  <div class="insight orange">
    <strong>Novo achado v2 ‚Äî Retrabalho inline:</strong> <code>CD_STATUS_RETRABALHO</code>, <code>DT_STATUS_RETRABALHO</code> e <code>CD_USER_RETRABALHO</code> est√£o inline na OP. Reprocessamento de lote tem requisitos GxP espec√≠ficos ‚Äî nova OP, novo dossi√™, rastreabilidade do lote original. O Kronix EBR precisa modelar esse fluxo. N√£o est√° no design atual.
  </div>

  <h3>2. Hierarquia da Receita e Execu√ß√£o ‚Äî Rela√ß√µes Completas</h3>

  <div class="relation-diagram">
    <span class="entity">FDB_ORDEM_PRODUCAO</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_OPERACAO</span> <span class="note">(opera√ß√µes / fases macro ‚Äî centro de trabalho, datas reais)</span><br>
    <span class="entity">FDB_ORDEM_PRODUCAO</span> <span class="arrow">‚îÄ‚îÄ1:1‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_CABECALHO</span> <span class="note">(status da receita, lote de inspe√ß√£o, data de in√≠cio programado)</span><br>
    <span class="entity">FDB_ORDEM_OPERACAO</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_FASE</span> <span class="note">(steps da execu√ß√£o com in√≠cio/fim real, respons√°vel, status, checklist, nota GQ)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_INSTRUCAO</span> <span class="note">(instru√ß√µes textuais por fase)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_TEXTO</span> <span class="note">(textos longos complementares por instru√ß√£o)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_CARACTERISTICA</span> <span class="note">(par√¢metros capturados: valor, usu√°rio, controle CQ)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_CAPTURA_FASE</span> <span class="note">(captura de fotos por fase: m√°x. fotos, texto informativo)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_BOM</span> <span class="note">(componentes consumidos por fase)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_ETIQUETA</span> <span class="note">(etiquetas geradas e impressas ‚Äî ZPL armazenado por etiqueta)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄN:M‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECURSO</span> <span class="note">via FDB_RECURSO_ATIVIDADE (aloca√ß√£o de equipamento/sala/linha)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄN:M‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_BIN_ITENS</span> <span class="note">via FDB_RECEITA_BIN (leitura barcode de materiais por fase)</span><br>
    <span class="entity">FDB_FASE_HIERARQUIA</span> <span class="arrow">‚îÄ‚îÄ grafo dirigido ‚îÄ‚îÄ‚ñ∂</span> <span class="note">(CD_FASE ‚Üí CD_FASE_ANTEC ‚Äî a receita J√Å √â um DAG, n√£o lista linear)</span><br>
    <span class="entity">FDB_FASE_HIERARQUIA2</span> <span class="arrow">‚îÄ‚îÄ grafo alternativo ‚îÄ‚îÄ‚ñ∂</span> <span class="note">(segunda representa√ß√£o hier√°rquica ‚Äî prop√≥sito a confirmar com Gustavo Fontes)</span>
  </div>

  <div class="insight green">
    <strong>Confirma√ß√£o arquitetural:</strong> A tabela <code>FDB_FASE_HIERARQUIA</code> (CD_FASE ‚Üí CD_FASE_ANTEC) confirma que o legado j√° modela a receita como um <strong>grafo dirigido</strong> (DAG). O React Flow como engine visual para o Kronix EBR est√° alinhado com o modelo mental do legado. Novo achado: existe <code>FDB_FASE_HIERARQUIA2</code> com a mesma estrutura ‚Äî confirmar com Gustavo Fontes se √© uma vers√£o alternativa em uso ou legado de refatora√ß√£o.
  </div>

  <div class="two-col">
    <div class="table-card">
      <h4>FDB_FASE ‚Äî Step da execu√ß√£o (40 colunas)</h4>
      <p>Granularidade real de execu√ß√£o. Cada fase tem in√≠cio e fim real, usu√°rio de in√≠cio/fim, status, centro de trabalho, flag de confirma√ß√£o SAP, corre√ß√£o GxP, nota GQ e flag de checklist.</p>
      <div class="cols">
        <span class="col-tag pk">CD_FASE + CD_ORDEM_PRODU</span>
        <span class="col-tag fk">CD_OPERA</span>
        <span class="col-tag key">CD_STATUS</span>
        <span class="col-tag audit">DT_INICI / CD_USER_INICI</span>
        <span class="col-tag audit">DT_FINAL / CD_USER_FINAL</span>
        <span class="col-tag">FL_CORRECAO / CD_FLUXO_SET_CORRECAO</span>
        <span class="col-tag">FL_CHECKLIST / FL_CONSUMO_SAP / FL_CONFIR</span>
        <span class="col-tag audit">CD_USER_NOTA_D_GQ / DT_USER_NOTA_D_GQ / FL_NOTA_D</span>
        <span class="col-tag new">CD_STATUS_RETRABALHO / FL_FINALIZADA</span>
        <span class="col-tag new">CD_USUAR_JUST_ZAMAT / DT_ASSIN_JUST_ZAMAT</span>
        <span class="col-tag">CD_CENTR_TRABA / CD_CENTR_TRABA_REAL / QT_COLAB</span>
        <span class="col-tag audit">INSERT_USER / UPDATE_USER / INSERT_TIMESTAMP / UPDATE_TIMESTAMP</span>
      </div>
    </div>
    <div class="table-card">
      <h4>FDB_RECEITA_CARACTERISTICA ‚Äî Par√¢metros capturados (21 colunas)</h4>
      <p>Captura de par√¢metros por instru√ß√£o: valor, forma de captura, data de execu√ß√£o, usu√°rio e flag de controle CQ. √â o cora√ß√£o do "formul√°rio de execu√ß√£o" do legado.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_INSTR + CD_SEQUE</span>
        <span class="col-tag key">CD_CARAC</span>
        <span class="col-tag key">VL_CARAC</span>
        <span class="col-tag audit">DT_EXECU / CD_EXECU_USUA</span>
        <span class="col-tag">FL_CONTR / CD_USER_CONTR</span>
        <span class="col-tag">VL_CARAC_BKP</span>
      </div>
    </div>
  </div>

  <div class="two-col">
    <div class="table-card">
      <h4>FDB_RECEITA_CABECALHO ‚Äî Cabe√ßalho da receita por OP (14 colunas) <span class="v2-badge">NOVO v2</span></h4>
      <p>Tabela separada que controla o status da receita dentro da OP, lote de inspe√ß√£o e datas de encerramento. √â o header da receita instanciada ‚Äî separado da OP raiz.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU</span>
        <span class="col-tag key">CD_STATUS / CD_STATUS_BKP</span>
        <span class="col-tag">CD_LOTE_INSPE</span>
        <span class="col-tag audit">DT_INICI_PROGR / CD_USER_ENCER / DT_ENCER</span>
      </div>
    </div>
    <div class="table-card">
      <h4>FDB_RECEITA_TEXTO ‚Äî Textos longos por instru√ß√£o (11 colunas) <span class="v2-badge">NOVO v2</span></h4>
      <p>Textos longos complementares vinculados √† instru√ß√£o por n√∫mero de sequ√™ncia. Separado da instru√ß√£o principal ‚Äî indica que instru√ß√µes podem ter m√∫ltiplos blocos de texto.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_INSTR + NR_SEQUE</span>
        <span class="col-tag key">DS_TEXTO</span>
      </div>
    </div>
  </div>

  <div class="two-col">
    <div class="table-card">
      <h4>FDB_RECEITA_CAPTURA / FDB_RECEITA_CAPTURA_FASE ‚Äî Templates de foto <span class="v2-badge">NOVO v2</span></h4>
      <p><code>FDB_RECEITA_CAPTURA</code> (21 cols) √© o template de captura de imagem definido por material/fase/instru√ß√£o no template de receita (n√£o por OP). <code>FDB_RECEITA_CAPTURA_FASE</code> (14 cols) √© a inst√¢ncia por OP, com n√∫mero m√°ximo de fotos e textos informativos. O legado controla captura fotogr√°fica por fase ‚Äî o Kronix EBR precisa modelar isso.</p>
      <div class="cols">
        <span class="col-tag">CD_MATER_REF / CD_FASE_REF / CD_INSTR_REF (template)</span>
        <span class="col-tag">VERSAO_PROD / DOC_PARCIAL / REVISAO / ECM</span>
        <span class="col-tag key">NR_MAX_FOTO / TEXTO_INF / TEXTO_PARAM</span>
        <span class="col-tag">FL_ATIVO / EXCLUIDO</span>
      </div>
    </div>
    <div class="table-card">
      <h4>FDB_RECEITA_BIN / FDB_RECEITA_BIN_ITENS ‚Äî Leitura barcode por fase <span class="v2-badge">NOVO v2</span></h4>
      <p>Rastreabilidade de leitura de c√≥digo de barras de materiais durante a execu√ß√£o da fase. Confirma que o legado tem verifica√ß√£o de material via scan durante a execu√ß√£o ‚Äî n√£o apenas digita√ß√£o de lote.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_RECUR</span>
        <span class="col-tag key">CD_CODIG_BARRA / CD_MATER / CD_LOTE</span>
        <span class="col-tag audit">DT_LEITURA / CD_USUAR_LEITURA</span>
        <span class="col-tag key">CD_STATU</span>
      </div>
    </div>
  </div>

  <h3>3. BOM da Receita ‚Äî Lista T√©cnica Instanciada</h3>
  <div class="two-col">
    <div class="table-card">
      <h4>FDB_RECEITA_LT ‚Äî Lista T√©cnica por OP (13 colunas) <span class="v2-badge">NOVO v2</span></h4>
      <p>Lista t√©cnica (BOM) instanciada para a OP, por material e unidade de medida. Separa o BOM do SAP do BOM executado pelo EBR ‚Äî importante para reconcilia√ß√£o.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_LISTA_TECNI</span>
        <span class="col-tag key">CD_MATER / CD_UM / QT_PLANE</span>
        <span class="col-tag fk">CD_CENTR</span>
      </div>
    </div>
    <div class="table-card">
      <h4>FDB_RECEITA_LTC ‚Äî Componentes da Lista T√©cnica (17 colunas) <span class="v2-badge">NOVO v2</span></h4>
      <p>Detalhe de componentes: posi√ß√£o, unidade de medida, quantidade utilizada, flag de c√°lculo autom√°tico, alternativas de item com agrupamento e sequ√™ncia.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_LISTA_TECNI + NR_POSIC</span>
        <span class="col-tag key">CD_MATER / CD_UM / QT_UTILI</span>
        <span class="col-tag">FL_CALCU / CD_ITEM_ALTER_AGRUP / CD_ITEM_ALTER_SEQUE / FL_CLASS</span>
      </div>
    </div>
  </div>

  <h3>4. Dossi√™ de Lote (BPR)</h3>

  <div class="table-card">
    <h4>FDB_DOSSIE ‚Äî Registro de Dossi√™ por OP (18 colunas)</h4>
    <p>O dossi√™ √© gerado como arquivo (PDF/XML) e referenciado aqui com categoria, subcategoria, status e caminho de arquivo. O campo <code>CD_FLUXO_SET_CORRECAO</code> indica fluxo de corre√ß√£o regulat√≥ria com workflow pr√≥prio. A tabela <code>FDB_DOSSIE_AUDIT</code> rastreia o hist√≥rico de arquivos do dossi√™ separadamente.</p>
    <div class="cols">
      <span class="col-tag pk">CD_DOSSI</span>
      <span class="col-tag fk">CD_ORDEM_PRODU</span>
      <span class="col-tag key">CD_STATU</span>
      <span class="col-tag">CD_CATEG / CD_SUBCA</span>
      <span class="col-tag">NM_ARQUI / DS_PATCH</span>
      <span class="col-tag">FL_CORRECAO / CD_FLUXO_SET_CORRECAO</span>
      <span class="col-tag new">FDB_DOSSIE_AUDIT ‚Üí rastreia arquivos do dossi√™ por OP</span>
    </div>
  </div>

  <div class="insight orange">
    <strong>Gap de design:</strong> O legado tem <code>FDB_XML_DOSSIE</code>, <code>FDB_XML_DOSSIE_ORIGINAL</code> e <code>FDB_XML_DOSSIE_REPLACES</code> ‚Äî tr√™s tabelas que armazenam o XML do dossi√™ com hist√≥rico de substitui√ß√µes. Isso indica que o dossi√™ pode ser <em>re-gerado e substitu√≠do</em> durante o fluxo de corre√ß√£o GxP. O Kronix EBR precisa modelar esse ciclo: gera√ß√£o ‚Üí revis√£o ‚Üí substitui√ß√£o ‚Üí vers√£o final. Apenas armazenar o PDF no S3 sem versionamento pode ser insuficiente.
  </div>

  <h3>5. Etiquetas e Rastreabilidade de Volume</h3>
  <div class="table-card">
    <h4>FDB_ORDEM_ETIQUETA ‚Äî Ciclo de vida completo da etiqueta (40 colunas)</h4>
    <p>Gerencia todo o ciclo: cria√ß√£o ‚Üí impress√£o ‚Üí reimpress√£o ‚Üí cancelamento ‚Üí leitura (scan) ‚Üí consumo. O campo <strong>ZPL</strong> est√° presente diretamente na tabela ‚Äî o template ZPL √© armazenado por etiqueta. Inclui hist√≥rico em <code>FDB_ORDEM_ETIQUETA_HISTO</code> e tabela de motivo de cancelamento.</p>
    <div class="cols">
      <span class="col-tag pk">CD_ETIQUETA</span>
      <span class="col-tag fk">CD_ORDEM_PRODU / CD_FASE</span>
      <span class="col-tag audit">DT_CRIADO / CD_USER_CRIADO</span>
      <span class="col-tag audit">DT_IMPRESSAO / CD_USER_IMPRESSAO</span>
      <span class="col-tag audit">DT_REIMPRESSAO / CD_USER_REIMPRESSAO</span>
      <span class="col-tag audit">DT_CANCELADO / CD_USER_CANCELADO / CD_MOTIVO_CANCELADO</span>
      <span class="col-tag audit">DT_CONSUMIDA / CD_USER_CONSUMIDA / CD_FASE_CONSUMIDA</span>
      <span class="col-tag key">ZPL</span>
    </div>
  </div>

  <h3>6. Recurso ‚Äî Equipamentos e Salas</h3>
  <div class="table-card">
    <h4>FDB_RECURSO ‚Äî Equipamento / Sala / Linha (28 colunas)</h4>
    <p>Recurso √© o conceito unificado para equipamentos, salas limpas e linhas de produ√ß√£o. Tem tipo, status operacional, centro de trabalho SAP, setor, tag IoT e flags de OEE. Relacionado ao Logbook via <code>FDB_RECURSO_ATIVIDADE</code>.</p>
    <div class="cols">
      <span class="col-tag pk">CD_RECUR</span>
      <span class="col-tag fk">CD_CENTR_TRABA / CD_CENTR</span>
      <span class="col-tag key">CD_TIPO_RECUR / CD_STATU</span>
      <span class="col-tag">CD_TAG (tag IoT SAP MII)</span>
      <span class="col-tag">CD_GRUPO / CD_SUBGRUPO / CD_AREA</span>
      <span class="col-tag">FL_INATIVO</span>
    </div>
  </div>
  <div class="insight blue">
    <strong>Insight Logbook:</strong> O Logbook no legado √© centrado no <em>Recurso</em>, n√£o na OP. <code>FDB_RECURSO_ATIVIDADE</code> registra: tipo de atividade (limpeza, sanitiza√ß√£o, calibra√ß√£o), in√≠cio/fim, usu√°rios de in√≠cio e fim/supervisor, validade da atividade e vincula√ß√£o √† OP. O <code>FL_ENCERRADO</code> em <code>FDB_LOGBOOK_COLETIVO</code> e o conceito de "tempo de vida" (<code>FDB_FR_TEMPODEVIDA</code>) indicam que o logbook controla a validade do recurso para uso ‚Äî isso √© line clearance.
  </div>
</section>

<!-- SUBSISTEMAS COMPLETOS -->
<section id="subsistemas" class="section-nav">
  <h2><span class="icon">üî©</span> Subsistemas Completos <span class="v2-badge">NOVO v2 ‚Äî An√°lise aprofundada</span></h2>

  <p style="margin-bottom:20px;color:#444;line-height:1.65;">A an√°lise v1 identificava esses m√≥dulos com 1-2 tabelas cada. O double-check sobre o GraphML revelou que s√£o subsistemas completos com m√∫ltiplas tabelas, fluxos de integra√ß√£o SAP e impactos de escopo significativos.</p>

  <h3>Hold Time de Processo ‚Äî 5 tabelas (subanalisado na v1)</h3>
  <div class="insight red">
    <strong>Hold Time n√£o √© um campo ‚Äî √© um subsistema.</strong> Possui thresholds m√∫ltiplos (base, 50%, 100%, CK), calculados independentemente para fases da OP, semiacabados e volumes de container. Se o RBBL usa Hold Time, o Kronix EBR precisa modelar todo esse subsistema para Wave 1.
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_HT_PROCESSO</h4><span class="count">36 colunas</span></div>
    <div class="subsystem-body">
      Cabe√ßalho de Hold Time por OP. Controla status da OP e do processo, flag de fertilidade (FL_FERT), peso de refer√™ncia, e quatro conjuntos de thresholds com datas de validade calculadas: base, 50%, 100% e CK.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU</span>
        <span class="col-tag key">CD_STATUS_OP / CD_STATUS_PROC</span>
        <span class="col-tag">FL_FERT / VL_PESAGEM / HT_PESAGEM_DT / HT_PESAGEM_DT_CALC</span>
        <span class="col-tag key">HT_DT_VAL / HT_ORDEM / HT_ORDEM_SEMI (threshold base)</span>
        <span class="col-tag key">HT_DT_VAL_50 / HT_ORDEM_50 / HT_ORDEM_SEMI_50 (threshold 50%)</span>
        <span class="col-tag key">HT_DT_VAL_100 / HT_ORDEM_100 / HT_ORDEM_SEMI_100 (threshold 100%)</span>
        <span class="col-tag key">HT_DT_VAL_CK / HT_ORDEM_CK / HT_ORDEM_SEMI_CK (threshold CK)</span>
        <span class="col-tag">FF_CODIGO / FF_GRUPO / FF_SUBGRUPO</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_HT_PROCESSO_ORDEM</h4><span class="count">27 colunas ‚Äî Hold Time por instru√ß√£o/fase</span></div>
    <div class="subsystem-body">
      Hold Time calculado por instru√ß√£o e fase da OP. Cada instru√ß√£o tem sua pr√≥pria base de c√°lculo de Hold Time (fase base, opera√ß√£o base) e os thresholds resultantes.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_INSTR + CD_FASE</span>
        <span class="col-tag fk">CD_OPERA / CD_OPERA_BASE / CD_FASE_BASE</span>
        <span class="col-tag">CD_DATA_BASE / CD_DATA_BASE_CALC</span>
        <span class="col-tag key">HT_BASE_DIAS / HT_BASE_HHMMSS</span>
        <span class="col-tag key">HT_ORDEM / HT_ORDEM_50 / HT_ORDEM_100 / HT_ORDEM_CK</span>
        <span class="col-tag">PROCES_MSG (status de processamento)</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_HT_PROCESSO_ORDEM_SEMI</h4><span class="count">18 colunas ‚Äî Hold Time de semiacabados</span></div>
    <div class="subsystem-body">
      Hold Time espec√≠fico para semiacabados (mat√©rias-primas intermedi√°rias) da OP. Tem thresholds pr√≥prios independentes das fases.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_SEMI</span>
        <span class="col-tag">CD_DATA_BASE / CD_DATA_BASE_CALC / HT_BASE_DIAS / HT_BASE_HHMMSS</span>
        <span class="col-tag key">HT_SEMI / HT_SEMI_50 / HT_SEMI_100 / HT_SEMI_CK</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_HT_PROCESSO_VOLUMES</h4><span class="count">14 colunas ‚Äî Hold Time por volume/container</span></div>
    <div class="subsystem-body">
      Hold Time calculado no n√≠vel de lote e container de material, com datas de validade por n√≠vel de threshold. Confirma que o Hold Time pode ter granularidade de container f√≠sico.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_MATER + CD_LOTE</span>
        <span class="col-tag key">HT_DT_VAL / HT_DT_VAL_50 / HT_DT_VAL_100 / HT_DT_VAL_CK</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_ORDEM_HOLDTIME_DATA + FDB_ORDEM_BOM_HOLDTIME</h4><span class="count">13 + 12 colunas</span></div>
    <div class="subsystem-body">
      <code>FDB_ORDEM_HOLDTIME_DATA</code> captura dados de Hold Time por lote e caracter√≠stica durante a execu√ß√£o. <code>FDB_ORDEM_BOM_HOLDTIME</code> registra Hold Time no n√≠vel de container do BOM com nota SAP.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_LOTE + CD_CARAC</span>
        <span class="col-tag key">VL_CARAC</span>
        <span class="col-tag audit">DT_INSERT</span>
        <span class="col-tag">CD_CONTA / NOTA_SAP (BOM_HOLDTIME)</span>
      </div>
    </div>
  </div>

  <h3>Reconcilia√ß√£o de Lote ‚Äî 5 tabelas (subanalisado na v1)</h3>
  <div class="insight red">
    <strong>Reconcilia√ß√£o tem fluxo SAP bidirecional com suporte a estorno.</strong> N√£o √© apenas balan√ßo de massa ‚Äî gera documentos SAP (MM) de devolu√ß√£o, perda e perda de desvio. Tem hist√≥rico audit√°vel com suporte a estorno, obrigat√≥rio para rastreabilidade GxP.
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_ORDEM_RECON</h4><span class="count">15 colunas ‚Äî Cabe√ßalho de reconcilia√ß√£o</span></div>
    <div class="subsystem-body">
      Status de reconcilia√ß√£o da OP, documentos SAP gerados (devolu√ß√£o, perda, perda de desvio), timestamp e usu√°rio de sincroniza√ß√£o com SAP.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU</span>
        <span class="col-tag key">FL_STATU</span>
        <span class="col-tag">CD_DOCUM_DEVOL / CD_DOCUM_PERDA / CD_DOCUM_PERDA_D (docs SAP MM)</span>
        <span class="col-tag audit">DT_SINC / USR_SINC / DT_ULT_ALTER</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_ORDEM_RECON_COMPONENTE</h4><span class="count">20 colunas ‚Äî Detalhe por material/lote</span></div>
    <div class="subsystem-body">
      Balan√ßo de massa por componente: quantidade consumida, devolvida e perdida por material/lote/dep√≥sito, com documentos SAP gerados para cada movimento.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_MATER + CD_LOTE</span>
        <span class="col-tag key">QT_CONSU / QT_DEVOL / QT_PERDA</span>
        <span class="col-tag fk">CD_DEPOS / CD_CONTA_VOLUM</span>
        <span class="col-tag audit">CD_DOCUM_DEVOL / CD_DOCUM_PERDA / CD_DOCUM_PERDA_D / DT_CRIACAO_DOC / USUARIO</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_ORDEM_RECON_HISTORICO</h4><span class="count">23 colunas ‚Äî Hist√≥rico com suporte a estorno</span></div>
    <div class="subsystem-body">
      Hist√≥rico audit√°vel de reconcilia√ß√£o com suporte a estorno completo: flag de estorno, usu√°rio e data de estorno. Isso indica que movimentos de reconcilia√ß√£o podem ser desfeitos ‚Äî fluxo regulat√≥rio cr√≠tico.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_MATER + CD_LOTE + DT_CRIACAO</span>
        <span class="col-tag key">QT_CONSU / QT_DEVOL / QT_PERDA</span>
        <span class="col-tag audit">FL_ESTORNO / USUAR_ESTORNO / DT_ESTORNO</span>
        <span class="col-tag">CD_DOCUM_DEVOL / CD_DOCUM_PERDA / CD_DOCUM_PERDA_D</span>
      </div>
    </div>
  </div>

  <div class="two-col">
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_ORDEM_PERDA + FDB_ORDEM_PERDA_VOLUME</h4><span class="count">16 + 19 colunas</span></div>
      <div class="subsystem-body">
        Registro de perdas com envio SAP MM. <code>FDB_ORDEM_PERDA_VOLUME</code> detalha a perda no n√≠vel de container/volume com flags de perda e envio SAP.
        <div class="cols">
          <span class="col-tag pk">CD_PERDA / CD_PERDA_VOLUME</span>
          <span class="col-tag fk">CD_ORDEM_PRODU / CD_CONTA_VOLUM</span>
          <span class="col-tag key">CD_STATUS / FL_ENVIO_SAP / DOC_SAP</span>
          <span class="col-tag audit">DT_INICIO / DT_FIM / CD_USUARIO</span>
        </div>
      </div>
    </div>
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_ORDEM_DEVOLUCAO + FDB_ORDEM_DEVOLUCAO_VOLUME</h4><span class="count">24 + 21 colunas</span></div>
      <div class="subsystem-body">
        Registro de devolu√ß√µes ao almoxarifado com origem e destino de dep√≥sito, envio SAP MM. Rastreia de qual posi√ß√£o de estoque o material saiu e para onde volta.
        <div class="cols">
          <span class="col-tag pk">CD_DEVOL / CD_DEVOL_VOLUME</span>
          <span class="col-tag fk">CD_ORDEM_PRODU / CD_CONTA_VOLUM</span>
          <span class="col-tag key">CD_STATUS / FL_ENVIO_SAP / DOC_SAP</span>
          <span class="col-tag">ORIGEM_DEPOS / DESTINO_DEPOS / DESTINO_IMPRESSORA</span>
        </div>
      </div>
    </div>
  </div>

  <h3>Folha de Trabalho por Turno ‚Äî 3 tabelas (ausente na v1) <span class="v2-badge">NOVO v2</span></h3>
  <div class="insight purple">
    <strong>Subsistema de turno completamente ausente da an√°lise v1.</strong> O legado registra o trabalho por turno por opera√ß√£o, com equipe alocada (incluindo habilidade), ocorr√™ncias do turno e apontamento final para SAP. A presen√ßa de <code>HABILIDADE</code> na <code>FDB_FOLHA_TRABALHO_EQUIPE</code> confirma que habilidade por operador √© rastreada no legado como dado operacional, n√£o apenas cadastral.
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_FOLHA_TRABALHO</h4><span class="count">21 colunas ‚Äî Turno por opera√ß√£o</span></div>
    <div class="subsystem-body">
      Cabe√ßalho do turno de trabalho: per√≠odo, opera√ß√£o, status, apontamento final SAP e flag de origem. Cada turno gera um documento SAP de apontamento.
      <div class="cols">
        <span class="col-tag pk">CD_SEQUE_FOLHA</span>
        <span class="col-tag fk">CD_ORDEM_PRODU / CD_OPERA</span>
        <span class="col-tag key">CD_TURNO / CD_STATU_FOLHA</span>
        <span class="col-tag audit">DT_INICI / DT_FINAL / CD_USUAR_ABERT / CD_USUAR_FECHA</span>
        <span class="col-tag">FL_APONT_FINAL / CD_DOCUM_SAP / FL_ORIGE</span>
        <span class="col-tag new">CD_RECUR_PROD</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_FOLHA_TRABALHO_EQUIPE</h4><span class="count">15 colunas ‚Äî Operadores do turno</span></div>
    <div class="subsystem-body">
      Registro de cada operador no turno: login, in√≠cio e fim de trabalho, habilidade exercida e grupo de linha. Confirma que habilidade √© rastreada no n√≠vel da atividade executada.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_OPERA + CD_SEQUE_FOLHA + CD_LOGIN</span>
        <span class="col-tag audit">DT_INICI_TRABA / DT_FINAL_TRABA</span>
        <span class="col-tag key">HABILIDADE</span>
        <span class="col-tag">CD_GRUPO_LINHA</span>
      </div>
    </div>
  </div>

  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_FOLHA_TRABALHO_OCORRENCIA</h4><span class="count">20 colunas ‚Äî Ocorr√™ncias do turno</span></div>
    <div class="subsystem-body">
      Ocorr√™ncias registradas durante o turno: tipo, per√≠odo, colaboradores envolvidos, capacidade da linha durante a ocorr√™ncia. Inclui campos de integra√ß√£o com m√≥dulo de Absente√≠smo.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_OPERA + CD_SEQUE_FOLHA + ID_FOLHA_OCORR</span>
        <span class="col-tag key">CD_TIPO_OCORR / CD_STATU_FOLHA</span>
        <span class="col-tag audit">DT_INICI_OCORR / DT_FINAL_OCORR / CD_USER_ABERT</span>
        <span class="col-tag">QTD_COLAB / ABS_CD_RECUR / ABS_AVG_CAPAC / ABS_QT_COLAB</span>
      </div>
    </div>
  </div>

  <h3>Material Container e Volume ‚Äî Rastreabilidade F√≠sica <span class="v2-badge">NOVO v2</span></h3>
  <div class="insight blue">
    <strong>O legado rastreia containers f√≠sicos de material com granularidade de volume.</strong> Este subsistema √© a base para reconcilia√ß√£o de lote e pesagem ‚Äî cada container tem posi√ß√£o no armaz√©m SAP WM, lote, quantidade l√≠quida e status. Ausente da an√°lise v1.
  </div>

  <div class="two-col">
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_MATERIAL_CONTAINER</h4><span class="count">33 colunas</span></div>
      <div class="subsystem-body">
        Rastreamento de container f√≠sico por OP: n√∫mero de container, status, OT (Ordem de Transfer√™ncia) SAP WM, posi√ß√£o no armaz√©m, dupla confer√™ncia com usu√°rios e timestamps.
        <div class="cols">
          <span class="col-tag pk">CD_CONTA + CD_ORDEM_PRODU</span>
          <span class="col-tag key">NR_CONTA / CD_STATU</span>
          <span class="col-tag">CD_OT / CD_WHSE / CD_LETYP / CD_LGPLA (SAP WM)</span>
          <span class="col-tag audit">DT_RECEB / CD_USUAR_RECEB</span>
          <span class="col-tag audit">DT_CONFE / CD_USUAR_CONFE / DT_CONFE2 / CD_USUAR_CONFE2</span>
          <span class="col-tag">NOTA_SAP / CD_NOTA_SAP_USER / DT_NOTA_SAP</span>
        </div>
      </div>
    </div>
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_MATERIAL_CONTAINER_VOLUME</h4><span class="count">34 colunas</span></div>
      <div class="subsystem-body">
        Detalhe de volume dentro do container: material, lote, quantidade l√≠quida, c√≥digo de barras, dep√≥sito de origem, reserva SAP MM, data de pesagem.
        <div class="cols">
          <span class="col-tag pk">CD_CONTA_VOLUM + CD_VOLUM</span>
          <span class="col-tag fk">CD_CONTA / CD_ORDEM_PRODU / CD_FASE</span>
          <span class="col-tag key">CD_MATER / CD_LOTE / CD_STATU</span>
          <span class="col-tag key">CD_CODIG_BARRA / QT_LIQUI / CD_UM</span>
          <span class="col-tag">CD_DEPOS_ORIGE / CD_RESER / CD_RESER_ITEM</span>
          <span class="col-tag audit">DT_PESAGEM / DT_PESAGEM_FIM</span>
        </div>
      </div>
    </div>
  </div>

  <h3>Pesagem e Volumes de Produ√ß√£o <span class="v2-badge">NOVO v2</span></h3>
  <div class="two-col">
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_VOLUME_PESAGEM</h4><span class="count">22 colunas</span></div>
      <div class="subsystem-body">
        Pesagem por fase: fase de pesagem e de c√°lculo, recurso, quantidade l√≠quida, tara, usu√°rios de descida e pesagem, fator de convers√£o.
        <div class="cols">
          <span class="col-tag pk">CD_ORDEM_PRODU + CD_FASE_PESSA + CD_SEQUE</span>
          <span class="col-tag key">CD_RECUR / CD_UM / QT_LIQUI / QT_TARA</span>
          <span class="col-tag audit">DT_DESCA / CD_USUAR_DESCA / DT_PESAG / CD_USUAR_PESAG</span>
          <span class="col-tag">VL_FATOR_CONVER / CD_FASE_PESAG / CD_FASE_DEST_REV</span>
        </div>
      </div>
    </div>
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_VOLUME_PRODUCAO</h4><span class="count">38 colunas</span></div>
      <div class="subsystem-body">
        Produ√ß√£o por sequ√™ncia e recurso: caixas completas, incompletas, quantidade l√≠quida, turno, documento SAP de material, flag de estorno e apontamento final.
        <div class="cols">
          <span class="col-tag pk">CD_ORDEM_PRODU + NR_SEQUE</span>
          <span class="col-tag key">CD_RECUR / QT_LIQUI / CD_LOTE</span>
          <span class="col-tag key">QT_CAIXA_COMPL / QT_CAIXA_INCOM / QT_INCOM / QT_TOTAL</span>
          <span class="col-tag">CD_DOCUM_MATER / FL_SAP / FL_ESTOR</span>
          <span class="col-tag audit">DT_PESAG / CD_USUAR_PESAG / DT_APONT_FINAL / CD_USUAR_APONT_FINAL</span>
        </div>
      </div>
    </div>
  </div>

  <h3>Checklist de Lideran√ßa por Opera√ß√£o <span class="v2-badge">NOVO v2</span></h3>
  <div class="insight orange">
    <strong>Checklist de lideran√ßa com detec√ß√£o de desvio param√©trico e multi-assinatura.</strong> A <code>FDB_ORDEM_CHECKLIST_ITENS</code> (32 colunas) tem 5 campos de assinatura distintos por item (LIDER, GQ, LOG, SIGN1, SIGN2) e controle de desvio com range e valor fora de especifica√ß√£o. Este subsistema n√£o estava na an√°lise v1.
  </div>

  <div class="two-col">
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_ORDEM_CHECKLIST_CAB</h4><span class="count">15 colunas ‚Äî Cabe√ßalho</span></div>
      <div class="subsystem-body">
        Cabe√ßalho do checklist por opera√ß√£o: assinatura e data do l√≠der, flag de diverg√™ncia e quantidade de diverg√™ncias encontradas.
        <div class="cols">
          <span class="col-tag pk">CD_ORDEM_PRODU + CD_OPERA</span>
          <span class="col-tag audit">LIDER_ASS / LIDER_DT</span>
          <span class="col-tag key">FL_DIVERGENCIA / QT_DIVERGENCIA</span>
        </div>
      </div>
    </div>
    <div class="subsystem-box">
      <div class="subsystem-header"><h4>FDB_ORDEM_CHECKLIST_ITENS</h4><span class="count">32 colunas ‚Äî Itens com multi-assinatura</span></div>
      <div class="subsystem-body">
        Item de checklist com controle de desvio param√©trico: range, valor real, flag fora de par√¢metro, mensagem e justificativa. M√∫ltiplas assinaturas por item.
        <div class="cols">
          <span class="col-tag pk">CD_ORDEM_PRODU + CD_OPERA + CD_INSTR + CD_QUEST</span>
          <span class="col-tag audit">USER_LIDER / USER_GQ / USER_LOG / USER_SIGN1 / USER_SIGN2</span>
          <span class="col-tag key">OCOR_RANGE / OCOR_VALOR / OCOR_FORA / OCOR_FORA_MSG</span>
          <span class="col-tag">DS_JUSTIFICATIVA / NOTA_DESVIO</span>
          <span class="col-tag">ID_ANEXO_ENDERECAMENTO / ID_ANEXO_ANOMALIA</span>
        </div>
      </div>
    </div>
  </div>

  <h3>PCO ‚Äî Process Control / Coletas Manuais <span class="v2-badge">Detalhado v2</span></h3>
  <div class="subsystem-box">
    <div class="subsystem-header"><h4>FDB_PCO_COLETAS_MANUAIS</h4><span class="count">24 colunas ‚Äî Coleta manual de par√¢metros f√≠sicos</span></div>
    <div class="subsystem-body">
      Captura manual de par√¢metros f√≠sicos por coleta: aspecto visual, quantidade te√≥rica, faixas de aceita√ß√£o e alarme para peso, espessura e dureza. √â o m√≥dulo de controle de processo manual que complementa as coletas autom√°ticas via tags SAP MII.
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + DT_COLETA + CD_LADO</span>
        <span class="col-tag">CD_BARRICA / FREQUENCIA / ASPECTO / OBS</span>
        <span class="col-tag key">QT_PM_TEORICO</span>
        <span class="col-tag key">QT_PESO_AL_MIN / QT_PESO_AL_MAX (alarme peso)</span>
        <span class="col-tag key">QT_PESO_AC_MIN / QT_PESO_AC_MAX (aceite peso)</span>
        <span class="col-tag key">QT_ESPESSURA_MIN / QT_ESPESSURA_MAX</span>
        <span class="col-tag key">QT_DUREZA_MIN / QT_DUREZA_MAX</span>
        <span class="col-tag audit">CD_USER</span>
      </div>
    </div>
  </div>
</section>

<!-- AUDIT TRAIL LEGADO -->
<section id="audit-legado" class="section-nav">
  <h2><span class="icon">üîç</span> Audit Trail Legado ‚Äî Compara√ß√£o com Design Proposto</h2>

  <div class="two-col">
    <div>
      <h3>Legado: FDB_AUDIT</h3>
      <div class="table-card">
        <h4>Granularidade: por campo alterado (field-level)</h4>
        <p>Uma linha por campo modificado. Captura tabela, campo, valor antes e depois como texto simples. Sem contexto de entidade agregada. Controla quais campos auditar via <code>FDB_AUDIT_CONDICOES</code>.</p>
        <div class="cols">
          <span class="col-tag pk">TRAIL_ID</span>
          <span class="col-tag">ROW_ID (linha da tabela auditada)</span>
          <span class="col-tag key">TABELA</span>
          <span class="col-tag key">CAMPO</span>
          <span class="col-tag audit">DATAHORA</span>
          <span class="col-tag audit">USUARIO</span>
          <span class="col-tag">LOCAL_ID (origem: esta√ß√£o de trabalho)</span>
          <span class="col-tag key">VALOR_ANTES</span>
          <span class="col-tag key">VALOR_DEPOIS</span>
          <span class="col-tag">ACAO</span>
        </div>
      </div>
      <div class="insight orange" style="margin-top:8px;">
        <strong>Tabelas sat√©lite do Audit Trail:</strong>
        <br>‚Ä¢ <code>FDB_AUDIT_CONDICOES</code> ‚Äî define quais TABELA+CAMPO s√£o auditados (com XPATH)
        <br>‚Ä¢ <code>FDB_AUDIT_CONDICOES_DELETE</code> ‚Äî condi√ß√µes para audit de dele√ß√µes
        <br>‚Ä¢ <code>FDB_AUDIT_DELETE</code> (4 cols: TABELA, CAMPOS_CHAVE, VALORES_CHAVE, ROW_ID) ‚Äî rastreia dele√ß√µes
        <br>‚Ä¢ <code>FDB_AUDIT_LOCAL</code> ‚Äî rastreia terminal de origem (CD_DE ‚Üí CD_PARA)
        <br>‚Ä¢ <code>FDB_AUDIT_PROCESSO</code> ‚Äî controla auditoria por processo de neg√≥cio
      </div>
    </div>
    <div>
      <h3>Proposto: ebr_audit (Kronix)</h3>
      <div class="table-card">
        <h4>Granularidade: por entidade (before/after JSONB)</h4>
        <p>Uma linha por a√ß√£o em uma entidade. Captura o estado completo anterior e posterior como JSONB. Contexto rico: actor_id via SSO, tipo de entidade, motivo.</p>
        <div class="cols">
          <span class="col-tag pk">event_id UUID</span>
          <span class="col-tag audit">timestamp_utc TIMESTAMPTZ</span>
          <span class="col-tag audit">actor_id (SSO)</span>
          <span class="col-tag key">entity_type</span>
          <span class="col-tag key">action (CREATE/SIGN/APPROVE)</span>
          <span class="col-tag key">before_state JSONB</span>
          <span class="col-tag key">after_state JSONB</span>
          <span class="col-tag">reason TEXT (motivo GxP)</span>
        </div>
      </div>
      <div class="insight green" style="margin-top:8px;">
        <strong>Modelo entity-level:</strong> Mais f√°cil de reconstruir o hist√≥rico de uma entidade. Melhor para queries GxP "mostre o hist√≥rico desta OP". Mais volume por evento, mas menor n√∫mero de linhas. Requer estrat√©gia expl√≠cita para dele√ß√µes (equivalente ao FDB_AUDIT_DELETE).
      </div>
    </div>
  </div>

  <h3>Implica√ß√µes para Migra√ß√£o Hist√≥rica</h3>
  <div class="insight red">
    <strong>Problema de migra√ß√£o:</strong> Os dois modelos <em>n√£o s√£o diretamente compat√≠veis</em>. O legado tem audit por campo (N linhas por transa√ß√£o); o Kronix ter√° audit por entidade (1 linha por transa√ß√£o com JSONB). Para migrar o hist√≥rico seria necess√°rio agrupar as linhas do <code>FDB_AUDIT</code> por (ROW_ID, DATAHORA, USUARIO) e reconstruir o JSONB before/after por transa√ß√£o ‚Äî ETL n√£o trivial. <strong>Confirmar com √°rea de Qualidade: o hist√≥rico do audit trail legado precisa ser migrado ou apenas preservado em read-only?</strong> Se read-only, pode ficar em schema de arquivamento sem convers√£o.
  </div>

  <div class="insight orange">
    <strong>LOCAL_ID ‚Äî campo ausente no design Kronix:</strong> O legado rastreia <code>LOCAL_ID</code> (terminal/esta√ß√£o de trabalho) em praticamente todas as tabelas, inclusive no Audit Trail. Em ambiente regulat√≥rio farmac√™utico isso tem relev√¢ncia: a FDA pode questionar "de qual terminal essa assinatura foi feita". O Kronix EBR precisa capturar pelo menos o IP/device-id da requisi√ß√£o no registro de assinatura eletr√¥nica. <strong>Validar com √°rea de Qualidade se LOCAL_ID √© exig√™ncia regulat√≥ria no contexto atual.</strong>
  </div>
</section>

<!-- SHARED REFERENCE DB -->
<section id="shared-ref" class="section-nav">
  <h2><span class="icon">üóÑÔ∏è</span> Candidatos ao Shared Reference Database</h2>

  <p style="margin-bottom: 16px; color: #444; line-height: 1.65;">An√°lise das tabelas do legado para identificar candidatas a migrar para o banco compartilhado entre sites. Crit√©rios: (1) dados de cadastro, n√£o de processo; (2) n√£o cont√™m CD_ORDEM_PRODU como chave; (3) tabelas pequenas (lookup); (4) referenciadas transversalmente por m√∫ltiplos m√≥dulos.</p>

  <table class="ref-table">
    <thead>
      <tr>
        <th>Tabela Legado</th>
        <th>Colunas Chave</th>
        <th>Classifica√ß√£o</th>
        <th>Observa√ß√£o</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>FDB_UNIDADE_MEDIDA</code></td>
        <td>CD_UM, DS_UM, CD_ISO</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Referenciada em BOM, volumes, receita. Padr√£o universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_RECURSO</code></td>
        <td>CD_TIPO_RECUR, DS_TIPO, FL_INTER</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de equipamento: sala limpa, equipamento, linha. Universal entre sites.</td>
      </tr>
      <tr>
        <td><code>FDB_STATUS_RECURSO</code></td>
        <td>CD_STATU, NM_STATU</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status do equipamento: dispon√≠vel, em limpeza, em manuten√ß√£o. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_MATERIAL</code></td>
        <td>CD_TIPO_MATER, DS_TIPO_MATER</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de material farmac√™utico. Universal entre sites EMS.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_MOVIMENTO</code></td>
        <td>CD_TIPO_MOVIM, DS_TIPO_MOVIM</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de movimento de material (consumo, devolu√ß√£o, perda). Alinhado com SAP MM.</td>
      </tr>
      <tr>
        <td><code>FDB_TURNO</code></td>
        <td>CD_TURNO, DS_TURNO, DT_INICIO, DT_FIM</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Turnos de produ√ß√£o podem variar por site/f√°brica. <strong>Hip√≥tese:</strong> se os turnos s√£o padronizados no Grupo NC, √© shared. Confirmar.</td>
      </tr>
      <tr>
        <td><code>FDB_PERFIS</code></td>
        <td>PERFIL</td>
        <td><span class="pill risk">Aten√ß√£o ‚Äî impacto regulat√≥rio</span></td>
        <td>Perfis de acesso. Se compartilhado, uma mudan√ßa de perfil afeta todos os sites. Exige controle de mudan√ßa GxP. Avaliar se melhor manter por site.</td>
      </tr>
      <tr>
        <td><code>FDB_TELAS_ASSINATURA</code></td>
        <td>CD_TELA, CD_ROLE</td>
        <td><span class="pill risk">Aten√ß√£o ‚Äî impacto regulat√≥rio</span></td>
        <td>Define quais telas exigem assinatura eletr√¥nica por role. Se compartilhado, qualquer mudan√ßa altera requisitos de assinatura em todos os sites ‚Äî impacto GxP direto. <strong>Confirmar com √°rea de Qualidade.</strong></td>
      </tr>
      <tr>
        <td><code>FDB_ASSINATURA_CONTROLE</code></td>
        <td>CD_ACAO, PERFIS, RESTRICOES</td>
        <td><span class="pill risk">Alto risco ‚Äî n√£o recomendar shared</span></td>
        <td>Controla quais a√ß√µes exigem assinatura por perfil e centro. √â configura√ß√£o regulat√≥ria de alto impacto. Manter por site para isolamento de valida√ß√£o.</td>
      </tr>
      <tr>
        <td><code>FDB_ATIVIDADE / FDB_ATIVIDADE_TIPO</code></td>
        <td>CD_ATIVI, DS_ATIVI, CD_TIPO_ATIVI</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Tipos de atividade de logbook (limpeza, calibra√ß√£o, sanitiza√ß√£o). Provavelmente universal.</td>
      </tr>
      <tr>
        <td><code>FDB_DISCIPLINA</code></td>
        <td>CD_DISCI, DS_DISCI</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Disciplinas GxP para logbook. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_DOSSIE_CATEGORIA / FDB_DOSSIE_SUBCATEGORIA</code></td>
        <td>CD_CATEG, DS_CATEG, CD_SUBCA</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Categorias de dossi√™. Podem ser padronizadas ou variar por produto/site.</td>
      </tr>
      <tr>
        <td><code>FDB_DOSSIE_STATUS</code></td>
        <td>CD_STATU, DS_STATU</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status do dossi√™. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ORDEM_RECON_STATUS</code></td>
        <td>FL_STATU, DS_STATU</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status de reconcilia√ß√£o de lote. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ORDEM_STATUS</code></td>
        <td>CD_STATUS, DS_STATUS</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status da OP. Alinhado com status SAP. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_VALIDACAO</code></td>
        <td>CD_TIPO_VALID</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de valida√ß√£o de par√¢metro. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ANEXO_TIPO_QUESTAO</code></td>
        <td>CD_TIPO_QUEST, DS_TIPO_QUEST</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de quest√£o do formul√°rio: resposta livre, op√ß√£o, calculada, estat√≠stica. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_STATUS_AMOSTRA</code></td>
        <td>CD_STATUS_AMOST, DS_STATUS_AMOST</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Status de amostras. Pode ser universal ou variar por processo anal√≠tico do site.</td>
      </tr>
      <tr>
        <td><code>FDB_FOLHA_TRABALHO_STATUS</code></td>
        <td>CD_STATU_FOLHA, DS_STATU_FOLHA</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td><span class="v2-badge">NOVO v2</span> Status da folha de trabalho por turno. Lookup universal.</td>
      </tr>
    </tbody>
  </table>

  <div class="insight orange" style="margin-top: 20px;">
    <strong>Recomenda√ß√£o:</strong> Tabelas de <em>configura√ß√£o regulat√≥ria</em> ‚Äî <code>FDB_ASSINATURA_CONTROLE</code>, <code>FDB_TELAS_ASSINATURA</code>, <code>FDB_PERFIS</code> e <code>FDB_AUDIT_CONDICOES</code> ‚Äî <strong>n√£o devem ir para o Shared Reference DB</strong>. Qualquer mudan√ßa nelas tem impacto no sistema validado e requer controle de mudan√ßa GxP por site. Mant√™-las no banco de cada site preserva o isolamento de valida√ß√£o.
  </div>
</section>

<!-- GAP ANALYSIS -->
<section id="gap-analysis" class="section-nav">
  <h2><span class="icon">üîé</span> Gap Analysis ‚Äî O que existe no legado e est√° fora do design atual</h2>

  <table class="gap-table">
    <thead>
      <tr>
        <th style="width:22%">Funcionalidade</th>
        <th style="width:20%">Tabelas Legado</th>
        <th style="width:13%">Status Kronix</th>
        <th style="width:45%">Observa√ß√£o / Risco</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Controle de Ponto / Absente√≠smo detalhado</strong></td>
        <td><code>FDB_ABS_CONTROLE_PONTO</code><br><code>FDB_ABS_CONTROLE_PONTO_HISTORICO</code><br><code>FDB_ABS_VIEW_CONTROLE_PONTO_CATRACA</code></td>
        <td><span class="pill future">Wave futura</span></td>
        <td>O legado tem integra√ß√£o com catraca e rel√≥gio de ponto (3 views separadas). O m√≥dulo de Absente√≠smo no Kronix √© wave futura, mas o legado sugere que √© mais complexo do que registrar aus√™ncia ‚Äî h√° controle de jornada com integra√ß√£o de hardware de acesso f√≠sico.</td>
      </tr>
      <tr>
        <td><strong>Habilidade por usu√°rio/linha</strong></td>
        <td><code>FDB_ABS_HABILIDADE</code><br><code>FDB_ABS_USUARIO_LINHA_HABILIDADE</code><br><code>FDB_FOLHA_TRABALHO_EQUIPE.HABILIDADE</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Controla quais habilidades um operador tem por linha de produ√ß√£o. <strong>Confirmado como campo operacional no legado</strong> ‚Äî a <code>FDB_FOLHA_TRABALHO_EQUIPE</code> rastreia a habilidade exercida por operador em cada turno. √â GxP ‚Äî um operador sem habilidade certificada n√£o deveria iniciar a fase. <strong>Validar com √°rea de Qualidade.</strong></td>
      </tr>
      <tr>
        <td><strong>N√£o-Conformidade de Aloca√ß√£o</strong></td>
        <td><code>FDB_ABS_AUTORIZA_NAO_CONFORME</code><br><code>FDB_ABS_AUTORIZA_NAO_CONFORME_RECURSO</code><br><code>FDB_ABS_AUTORIZA_NAO_CONFORME_EQUIPE</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Autoriza√ß√£o expl√≠cita para alocar operador "n√£o conforme" (fora de habilidade, com restri√ß√£o). Requer aprova√ß√£o de supervisor com justificativa. Fluxo GxP relevante ‚Äî contorna uma barreira de seguran√ßa com rastreabilidade completa.</td>
      </tr>
      <tr>
        <td><strong>PCO ‚Äî Coletas autom√°ticas via tag SAP MII</strong></td>
        <td><code>FDB_PCO_TAGS</code><br><code>FDB_PCO_TAG_VAL</code><br><code>FDB_PCO_GRUPO_REGRA</code><br><code>FDB_PCO_COLETAS_CHECKMASTER</code></td>
        <td><span class="pill wave1">Wave 1 ‚Äî escopo menor</span></td>
        <td>O PCO atual usa tags do SAP MII para leitura autom√°tica de par√¢metros com regras de alarme por f√≥rmula. O design atual menciona amostras manuais. A coleta autom√°tica via Kafka/IoT pode ser o substituto ‚Äî mas o modelo de regras de alarme n√£o est√° no design. <strong>Risco de escopo subestimado.</strong></td>
      </tr>
      <tr>
        <td><strong>PCO ‚Äî Coleta Manual de Par√¢metros F√≠sicos</strong></td>
        <td><code>FDB_PCO_COLETAS_MANUAIS</code></td>
        <td><span class="pill wave1">Wave 1 ‚Äî parcial</span></td>
        <td>Coleta manual estruturada com faixas de alarme e aceita√ß√£o para peso, espessura e dureza. O Kronix EBR prev√™ captura de par√¢metros, mas o modelo de faixas duplas (alarme + aceite) por par√¢metro n√£o est√° expl√≠cito no design.</td>
      </tr>
      <tr class="new-row">
        <td><strong>Folha de Trabalho por Turno</strong> <span class="v2-badge">NOVO v2</span></td>
        <td><code>FDB_FOLHA_TRABALHO</code><br><code>FDB_FOLHA_TRABALHO_EQUIPE</code><br><code>FDB_FOLHA_TRABALHO_OCORRENCIA</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Subsistema de turno por opera√ß√£o com equipe, ocorr√™ncias e apontamento final SAP. Inclui rastreamento de habilidade por operador/turno. <strong>Confirmar com Gustavo Fontes se o Kronix EBR precisa substituir esse m√≥dulo ou se o apontamento SAP via CPI cobre o caso.</strong></td>
      </tr>
      <tr class="new-row">
        <td><strong>Checklist de Lideran√ßa por Opera√ß√£o</strong> <span class="v2-badge">NOVO v2</span></td>
        <td><code>FDB_ORDEM_CHECKLIST_CAB</code><br><code>FDB_ORDEM_CHECKLIST_ITENS</code><br><code>FDB_ORDEM_CHECKLIST_OUTROS</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Checklist por opera√ß√£o com 5 tipos de assinatura distintas por item (LIDER, GQ, LOG, SIGN1, SIGN2), detec√ß√£o de desvio param√©trico com range e valor real, e justificativa obrigat√≥ria para desvios. Substancialmente mais rico que um checklist gen√©rico. <strong>Confirmar com √°rea de Qualidade se √© requisito Wave 1.</strong></td>
      </tr>
      <tr>
        <td><strong>Dossi√™ com versionamento</strong></td>
        <td><code>FDB_XML_DOSSIE_ORIGINAL</code><br><code>FDB_XML_DOSSIE_REPLACES</code><br><code>FDB_DOSSIE_AUDIT</code></td>
        <td><span class="pill gap">Parcial</span></td>
        <td>O legado armazena original + substitui√ß√µes do dossi√™. Apenas PDF no S3 pode ser insuficiente para o fluxo de corre√ß√£o GxP. O Kronix EBR precisa versionar o dossi√™.</td>
      </tr>
      <tr class="new-row">
        <td><strong>Rastreabilidade Barcode durante Execu√ß√£o</strong> <span class="v2-badge">NOVO v2</span></td>
        <td><code>FDB_RECEITA_BIN</code><br><code>FDB_RECEITA_BIN_ITENS</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>O legado registra leitura de c√≥digo de barras de materiais durante execu√ß√£o da fase ‚Äî n√£o apenas digita√ß√£o de lote. O Kronix EBR precisa definir se usar√° scan de barcode e como rastrear isso no registro de execu√ß√£o. Relevante para anti-erro de material.</td>
      </tr>
      <tr class="new-row">
        <td><strong>Captura Fotogr√°fica por Fase</strong> <span class="v2-badge">NOVO v2</span></td>
        <td><code>FDB_RECEITA_CAPTURA</code><br><code>FDB_RECEITA_CAPTURA_FASE</code><br><code>FDB_RECEITA_FASE_PHOTOS</code><br><code>FDB_RECEITA_CAPTURA_IMAGEM</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>O legado tem controle de captura fotogr√°fica por fase com n√∫mero m√°ximo de fotos configur√°vel no template. Fotos armazenadas com GUID e path por OP/instru√ß√£o. Requisito relevante para evid√™ncia visual em GxP ‚Äî confirmar com √°rea de Qualidade se √© exig√™ncia no RBBL.</td>
      </tr>
      <tr>
        <td><strong>Hold Time de Processo</strong></td>
        <td><code>FDB_HT_PROCESSO</code><br><code>FDB_HT_PROCESSO_ORDEM</code><br><code>FDB_HT_PROCESSO_ORDEM_SEMI</code><br><code>FDB_HT_PROCESSO_VOLUMES</code><br><code>FDB_ORDEM_HOLDTIME_DATA</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td><strong>Subsistema completo ‚Äî 5+ tabelas.</strong> Hold Time √© o tempo m√°ximo permitido entre fases farmac√™uticas. O legado tem thresholds m√∫ltiplos (50%, 100%, CK) calculados por fase, por semiacabado e por volume de container. N√£o est√° no design atual. <strong>Confirmar com Gustavo Fontes se √© pr√©-requisito para fechamento do BPR no RBBL.</strong></td>
      </tr>
      <tr>
        <td><strong>Reconcilia√ß√£o de Lote</strong></td>
        <td><code>FDB_ORDEM_RECON</code><br><code>FDB_ORDEM_RECON_COMPONENTE</code><br><code>FDB_ORDEM_RECON_HISTORICO</code><br><code>FDB_ORDEM_PERDA</code><br><code>FDB_ORDEM_DEVOLUCAO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td><strong>Subsistema completo ‚Äî 5+ tabelas.</strong> Balan√ßo de massa: consumido + devolvido + perdido = recebido. Integra√ß√£o SAP MM bidirecional com documentos gerados por movimento. Suporte a estorno de movimentos. Necess√°rio para fechamento da OP e gera√ß√£o do BPR. N√£o est√° no design atual.</td>
      </tr>
      <tr>
        <td><strong>Integridade de Dados da OP</strong></td>
        <td><code>FDB_ORDEM_INTEGRIDADE_DADOS</code><br><code>FDB_ORDEM_INTEG_DADOS_ITENS</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Checklist de gate antes de fechar a OP ‚Äî verifica campos obrigat√≥rios, assinaturas e reconcilia√ß√£o. Flag de NOK por item com justificativa. √â o "gate de qualidade" antes de gerar o dossi√™ final.</td>
      </tr>
      <tr>
        <td><strong>Filtros de Processo</strong></td>
        <td><code>FDB_ORDEM_INTEG_FILTRO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Controle GxP de filtros: n√∫mero de s√©rie, tipo, teste antes/depois do uso, par√¢metros fora de especifica√ß√£o. Espec√≠fico para formas farmac√™uticas est√©reis. Confirmar se aplica ao RBBL.</td>
      </tr>
      <tr>
        <td><strong>Retrabalho de Lote</strong></td>
        <td><code>FDB_ORDEM_PRODUCAO.CD_STATUS_RETRABALHO</code><br><code>FDB_ORDEM_PRODUCAO.DT_STATUS_RETRABALHO</code><br><code>FDB_FASE.CD_STATUS_RETRABALHO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Status de retrabalho inline na OP e nas fases. O retrabalho tem campo de status, data e usu√°rio tanto na OP quanto em cada fase. Reprocessamento de lote requer nova OP, novo dossi√™, rastreabilidade do lote original.</td>
      </tr>
      <tr>
        <td><strong>Rastreabilidade de Transfer√™ncia de Volume</strong></td>
        <td><code>FDB_ORDEM_TRANSFERENCIA</code><br><code>FDB_ORDEM_TRANSFERENCIA_VOLUME</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Transfer√™ncia de volume entre ordens (semi-acabado ‚Üí acabado) com envio SAP. Pode ser parte do escopo da NT (Necessidade de Transporte) integrado via SAP CPI.</td>
      </tr>
      <tr>
        <td><strong>Controle de Amostras (CA)</strong></td>
        <td><code>CA_AMOSTRA</code> (36 cols)<br><code>CA_AMOSTRA_H</code><br><code>CA_AMOSTRA_CAIXA / PALETE / PRO</code></td>
        <td><span class="pill future">Wave futura</span></td>
        <td>O m√≥dulo CA √© uma sub-plataforma completa com rastreabilidade de amostras por caixa, palete e PRO. 15 tabelas com hist√≥rico pr√≥prio. Muito mais complexo que "Controle de Amostra" como item de lista. Sugere integra√ß√£o com laborat√≥rio (LIMS).</td>
      </tr>
    </tbody>
  </table>

  <div class="insight red" style="margin-top: 20px;">
    <strong>Gaps priorit√°rios para valida√ß√£o antes de fechar o escopo Wave 1:</strong> <strong>Hold Time</strong> (subsistema de 5 tabelas com thresholds m√∫ltiplos) e <strong>Reconcilia√ß√£o de Lote</strong> (subsistema de 5 tabelas com integra√ß√£o SAP MM bidirecional) s√£o processos GxP fundamentais que provavelmente existem no RBBL. Se forem exigidos para fechamento do BPR no Go Live dez/2026 e n√£o estiverem no escopo, o risco de atraso √© alto. <strong>Confirmar com Gustavo Fontes (Tech Lead EBR legado) como prioridade m√°xima.</strong>
  </div>

  <div class="insight orange" style="margin-top: 12px;">
    <strong>Novos gaps identificados no double-check v2:</strong> Folha de Trabalho por Turno, Checklist de Lideran√ßa, Rastreabilidade Barcode durante Execu√ß√£o e Captura Fotogr√°fica por Fase s√£o subsistemas com impacto regulat√≥rio que n√£o estavam no radar. Habilidade por operador foi confirmada como dado operacional rastreado no legado ‚Äî n√£o apenas um requisito futuro.
  </div>
</section>

<!-- MIGRA√á√ÉO -->
<section id="migracao" class="section-nav">
  <h2><span class="icon">üöö</span> Insumos para Estrat√©gia de Migra√ß√£o</h2>

  <h3>Complexidade por m√≥dulo</h3>
  <div class="three-col">
    <div class="table-card">
      <h4>üü¢ Baixa complexidade</h4>
      <p>Tabelas de lookup / refer√™ncia ‚Äî migra√ß√£o direta de dados est√°ticos. Sem depend√™ncia de OP.</p>
      <div class="cols">
        <span class="col-tag">FDB_UNIDADE_MEDIDA</span>
        <span class="col-tag">FDB_TIPO_RECURSO</span>
        <span class="col-tag">FDB_ORDEM_STATUS</span>
        <span class="col-tag">FDB_DOSSIE_STATUS</span>
        <span class="col-tag">FDB_TURNO</span>
        <span class="col-tag">FDB_DISCIPLINA</span>
        <span class="col-tag">FDB_FOLHA_TRABALHO_STATUS</span>
        <span class="col-tag">FDB_ORDEM_RECON_STATUS</span>
      </div>
    </div>
    <div class="table-card">
      <h4>üü° M√©dia complexidade</h4>
      <p>Dados mestre ‚Äî Recurso, Material, Usu√°rio. Depend√™ncias de SAP e de outros sistemas.</p>
      <div class="cols">
        <span class="col-tag">FDB_RECURSO (+ param, + POP)</span>
        <span class="col-tag">FDB_MATERIAL (+ lote, + centro)</span>
        <span class="col-tag">FDB_USUARIOS</span>
        <span class="col-tag">FDB_PERFIS + FDB_USUARIO_PERFIL</span>
        <span class="col-tag">FDB_RECEITA_CABECALHO</span>
        <span class="col-tag">FDB_ABS_HABILIDADE (+ FDB_ABS_USUARIO_LINHA_HABILIDADE)</span>
      </div>
    </div>
    <div class="table-card">
      <h4>üî¥ Alta complexidade</h4>
      <p>Dados de processo ‚Äî OP, execu√ß√£o, audit trail, dossi√™, reconcilia√ß√£o, hold time. Volume alto, depend√™ncias cruzadas, requisitos regulat√≥rios, integra√ß√£o SAP bidirecional.</p>
      <div class="cols">
        <span class="col-tag">FDB_ORDEM_PRODUCAO (~hist√≥rico completo)</span>
        <span class="col-tag">FDB_FASE + FDB_FASE_HIERARQUIA</span>
        <span class="col-tag">FDB_AUDIT (campo a campo)</span>
        <span class="col-tag">FDB_DOSSIE + FDB_XML_DOSSIE*</span>
        <span class="col-tag">FDB_RECURSO_ATIVIDADE (logbook)</span>
        <span class="col-tag">FDB_HT_PROCESSO* (5 tabelas)</span>
        <span class="col-tag">FDB_ORDEM_RECON* (5 tabelas + docs SAP)</span>
        <span class="col-tag">CA_AMOSTRA* (15 tabelas)</span>
      </div>
    </div>
  </div>

  <h3>Tabelas de hist√≥rico ‚Äî n√£o migrar, preservar em read-only</h3>
  <div class="insight blue">
    <strong>O legado mant√©m tabelas *_HISTO para todas as entidades principais.</strong> Estas tabelas foram identificadas explicitamente no GraphML: <code>FDB_ORDEM_PRODUCAO_HISTO</code> (28 cols), <code>FDB_FASE_HISTO</code> (31 cols ‚Äî inclui campos de auditoria H_USUARIO, H_DATA, H_HORA), <code>FDB_ORDEM_OPERACAO_HISTO</code>, <code>FDB_ORDEM_BOM_HISTO</code>, <code>FDB_RECURSO_ATIVIDADE_LOG</code> (39 cols). Estas tabelas provavelmente alimentam relat√≥rios regulat√≥rios e devem ser preservadas em schema read-only, n√£o descartadas.
  </div>

  <h3>Pontos cr√≠ticos para decis√£o de cutover</h3>
  <div class="insight orange">
    <strong>Dois modelos de Audit Trail incompat√≠veis.</strong> Migrar o hist√≥rico de <code>FDB_AUDIT</code> (field-level) para o formato JSONB do Kronix requer ETL complexo. Alternativa mais pragm√°tica: manter <code>FDB_AUDIT</code> legado em schema <code>ebr_legacy_audit</code> somente leitura por 5 anos, com acesso via Kibana ou query direta. Isso evita convers√£o e garante imutabilidade do hist√≥rico regulat√≥rio.
  </div>
  <div class="insight blue">
    <strong>Dossi√™s XML hist√≥ricos.</strong> O legado armazena o dossi√™ como XML em banco de dados (<code>FDB_XML_DOSSIE</code>). A estrat√©gia mais simples √© exportar esses XMLs para S3 Object Lock (WORM) durante o cutover ‚Äî sem convers√£o, apenas arquivamento com reten√ß√£o 5 anos. Acesso posterior via pre-signed URL para auditorias.
  </div>
  <div class="insight blue">
    <strong>Paralelo de opera√ß√£o (parallel run).</strong> Dado que o legado usa SAP MII como plataforma (com tags de equipamento, integra√ß√µes de IDoc), o parallel run vai gerar dados duplicados em dois sistemas. Definir claramente: (1) qual sistema √© source of truth durante o paralelo; (2) como reconciliar diverg√™ncias; (3) crit√©rio de cut off por lote ou por data.
  </div>

  <h3>Pergunta de neg√≥cio para validar com Gustavo Fontes</h3>
  <div class="insight red">
    <strong>A migra√ß√£o hist√≥rica de lotes est√° mesmo fora do escopo?</strong> O modelo legado tem <code>FDB_ORDEM_PRODUCAO_HISTO</code>, <code>FDB_FASE_HISTO</code>, <code>FDB_ORDEM_BOM_HISTO</code> ‚Äî tabelas de hist√≥rico de todas as entidades principais. Regulatoriamente, se um inspetor da ANVISA pede o hist√≥rico de um lote de 2 anos atr√°s ap√≥s o Go Live, onde ele vai buscar? Se a resposta for "no sistema legado em modo read-only", isso precisa estar documentado no plano de valida√ß√£o (VSC). Se a resposta for "no Kronix EBR", a migra√ß√£o hist√≥rica <em>n√£o pode ser out-of-scope</em>.
  </div>
</section>

</main>

<footer>
  An√°lise gerada a partir de FDBs.graphml ‚Äî Banco Legado EBR EMS ¬∑ Kronix EBR ¬∑ NC Tech<br>
  v2.0 ‚Äî Double-check completo executado sobre GraphML com 598 tabelas ¬∑ fev/2026<br>
  ‚ö† Hip√≥teses sinalizadas devem ser validadas com Gustavo Fontes, √°rea de Qualidade e Consultoria GxP antes de qualquer decis√£o arquitetural.
</footer>

<script>
  const sections = document.querySelectorAll('.section-nav');
  const navLinks = document.querySelectorAll('nav a');
  window.addEventListener('scroll', () => {
    let current = '';
    sections.forEach(s => {
      if (window.scrollY >= s.offsetTop - 80) current = s.id;
    });
    navLinks.forEach(a => {
      a.classList.toggle('active', a.getAttribute('href') === '#' + current);
    });
  });
</script>
</body>
</html>
