<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An√°lise do Banco Legado EBR EMS ‚Äî Insumos para Kronix EBR</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f6fa; color: #222; font-size: 14px; }

  header {
    background: linear-gradient(135deg, #1a2744 0%, #2d4a8a 100%);
    color: white; padding: 28px 40px 22px;
    border-bottom: 4px solid #4a90d9;
  }
  header h1 { font-size: 22px; font-weight: 700; letter-spacing: 0.3px; }
  header .meta { font-size: 12px; opacity: 0.75; margin-top: 6px; }
  header .badge {
    display: inline-block; background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3); border-radius: 4px;
    padding: 3px 10px; font-size: 11px; margin-top: 10px; margin-right: 8px;
  }

  nav {
    background: #fff; border-bottom: 1px solid #dde3f0;
    padding: 0 40px; display: flex; gap: 0; position: sticky; top: 0; z-index: 100;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  }
  nav a {
    padding: 14px 20px; font-size: 13px; font-weight: 600; color: #555;
    text-decoration: none; border-bottom: 3px solid transparent;
    transition: all 0.2s; white-space: nowrap;
  }
  nav a:hover { color: #2d4a8a; background: #f0f4ff; }
  nav a.active { color: #2d4a8a; border-bottom-color: #2d4a8a; }

  main { max-width: 1200px; margin: 0 auto; padding: 32px 40px 60px; }

  section { margin-bottom: 48px; }
  section h2 {
    font-size: 18px; font-weight: 700; color: #1a2744;
    padding-bottom: 10px; border-bottom: 2px solid #dde3f0; margin-bottom: 20px;
    display: flex; align-items: center; gap: 10px;
  }
  section h2 .icon { font-size: 20px; }
  section h3 {
    font-size: 14px; font-weight: 700; color: #2d4a8a;
    margin: 24px 0 10px; text-transform: uppercase; letter-spacing: 0.5px;
  }

  /* SUMMARY CARDS */
  .summary-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px;
  }
  .summary-card {
    background: white; border-radius: 8px; padding: 20px;
    border: 1px solid #dde3f0; text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
  }
  .summary-card .number { font-size: 36px; font-weight: 800; color: #2d4a8a; line-height: 1; }
  .summary-card .label { font-size: 12px; color: #666; margin-top: 6px; }
  .summary-card.warn .number { color: #e07b00; }
  .summary-card.danger .number { color: #c0392b; }
  .summary-card.ok .number { color: #1a7a4a; }

  /* TABLE CARD */
  .table-card {
    background: white; border-radius: 8px; padding: 20px 24px;
    border: 1px solid #dde3f0; margin-bottom: 14px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
  }
  .table-card h4 {
    font-family: 'Courier New', monospace; font-size: 13px; font-weight: 700;
    color: #1a2744; margin-bottom: 8px;
  }
  .table-card p { font-size: 13px; color: #444; line-height: 1.6; }
  .table-card .cols {
    display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;
  }
  .table-card .col-tag {
    background: #f0f4ff; border: 1px solid #c8d8f0; border-radius: 3px;
    padding: 2px 7px; font-family: 'Courier New', monospace; font-size: 11px; color: #2d4a8a;
  }
  .table-card .col-tag.pk { background: #fff3cd; border-color: #f0c040; color: #856404; }
  .table-card .col-tag.fk { background: #e8f5e9; border-color: #81c784; color: #2e7d32; }
  .table-card .col-tag.audit { background: #fce4ec; border-color: #f48fb1; color: #880e4f; }
  .table-card .col-tag.key { background: #ede7f6; border-color: #b39ddb; color: #4527a0; font-weight: 700; }

  /* RELATIONS */
  .relation-diagram {
    background: #f8f9ff; border: 1px solid #dde3f0; border-radius: 8px;
    padding: 20px 24px; margin: 16px 0; font-family: 'Courier New', monospace; font-size: 12px;
    line-height: 2;
  }
  .relation-diagram .entity { color: #1a2744; font-weight: 700; }
  .relation-diagram .arrow { color: #2d4a8a; }
  .relation-diagram .note { color: #888; font-style: italic; font-family: 'Segoe UI', sans-serif; }

  /* INSIGHT BOXES */
  .insight {
    border-radius: 6px; padding: 14px 18px; margin: 16px 0;
    border-left: 4px solid; font-size: 13px; line-height: 1.65;
  }
  .insight.blue { background: #e8f0fe; border-color: #2d4a8a; color: #1a2744; }
  .insight.orange { background: #fff3e0; border-color: #e07b00; color: #5a3200; }
  .insight.red { background: #fdecea; border-color: #c0392b; color: #6b1a14; }
  .insight.green { background: #e8f5e9; border-color: #1a7a4a; color: #0d3d24; }
  .insight strong { font-weight: 700; }

  /* GRID LAYOUTS */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  /* REFERENCE TABLE */
  .ref-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .ref-table th {
    background: #1a2744; color: white; padding: 10px 14px;
    text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .ref-table td { padding: 9px 14px; border-bottom: 1px solid #eef0f7; vertical-align: top; }
  .ref-table tr:hover td { background: #f5f7ff; }
  .ref-table code { font-family: 'Courier New'; font-size: 12px; background: #f0f4ff; padding: 1px 5px; border-radius: 3px; }

  /* BADGE PILLS */
  .pill {
    display: inline-block; border-radius: 12px; padding: 2px 10px;
    font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.4px;
  }
  .pill.wave1 { background: #e3f2fd; color: #1565c0; }
  .pill.future { background: #f3e5f5; color: #6a1b9a; }
  .pill.new { background: #e8f5e9; color: #1b5e20; }
  .pill.gap { background: #fce4ec; color: #880e4f; }
  .pill.shared { background: #fff8e1; color: #f57f17; }
  .pill.risk { background: #fdecea; color: #b71c1c; }

  /* GAP TABLE */
  .gap-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .gap-table th {
    background: #2d3748; color: white; padding: 10px 14px;
    text-align: left; font-size: 12px;
  }
  .gap-table td { padding: 9px 14px; border-bottom: 1px solid #eef0f7; vertical-align: top; line-height: 1.55; }
  .gap-table tr:hover td { background: #f9f9ff; }

  .section-nav { scroll-margin-top: 60px; }

  footer {
    background: #1a2744; color: rgba(255,255,255,0.5);
    text-align: center; padding: 18px; font-size: 12px;
  }
</style>
</head>
<body>

<header>
  <h1>An√°lise do Banco Legado EBR EMS ‚Äî Insumos para Kronix EBR</h1>
  <div class="meta">Fonte: FDBs.graphml ‚Äî Diagrama yEd exportado do banco SAP MII | Kronix EBR Wave 1 ¬∑ Go Live dez/2026</div>
  <span class="badge">599 tabelas analisadas</span>
  <span class="badge">3 dimens√µes: Modelo Core ¬∑ Shared Reference ¬∑ Gap Analysis</span>
  <span class="badge">‚ö† Hip√≥teses sinalizadas ‚Äî validar com Gustavo Fontes / √°rea de Qualidade</span>
</header>

<nav>
  <a href="#resumo" class="active">Resumo</a>
  <a href="#modelo-core">Modelo Core</a>
  <a href="#audit-legado">Audit Trail Legado</a>
  <a href="#shared-ref">Shared Reference DB</a>
  <a href="#gap-analysis">Gap Analysis</a>
  <a href="#migracao">Migra√ß√£o</a>
</nav>

<main>

<!-- RESUMO EXECUTIVO -->
<section id="resumo" class="section-nav">
  <h2><span class="icon">üìä</span> Resumo Executivo</h2>

  <div class="summary-grid">
    <div class="summary-card">
      <div class="number">599</div>
      <div class="label">Tabelas totais no legado</div>
    </div>
    <div class="summary-card">
      <div class="number">430</div>
      <div class="label">Tabelas FDB (core EBR)</div>
    </div>
    <div class="summary-card warn">
      <div class="number">12</div>
      <div class="label">Gaps identificados no design atual</div>
    </div>
    <div class="summary-card ok">
      <div class="number">18</div>
      <div class="label">Candidatos ao Shared Reference DB</div>
    </div>
  </div>

  <div class="insight blue">
    <strong>O legado √© uma plataforma MES completa, n√£o um EBR simples.</strong> O prefixo FDB cobre 430 tabelas que incluem receita, execu√ß√£o, dossi√™, logbook, Audit Trail, amostras, controle de ponto (Absente√≠smo), PCO (Process Control), OEE, Plant Maintenance (PM) e m√≥dulos de controle de qualidade. A migra√ß√£o para o Kronix EBR √© de alta complexidade ‚Äî o escopo vai muito al√©m do que est√° mapeado nos m√≥dulos Wave 1.
  </div>

  <div class="insight orange">
    <strong>Aten√ß√£o: o Audit Trail do legado tem arquitetura completamente diferente da proposta para o Kronix EBR.</strong> O legado usa <code>FDB_AUDIT</code> com granularidade de <em>campo</em> (TRAIL_ID, TABELA, CAMPO, VALOR_ANTES, VALOR_DEPOIS) ‚Äî uma linha por campo alterado. O design proposto para o Kronix usa JSONB (before_state / after_state por entidade inteira). S√£o estrat√©gias distintas com implica√ß√µes para migra√ß√£o hist√≥rica. Detalhe na se√ß√£o Audit Trail Legado.
  </div>

  <div class="insight red">
    <strong>O PCO (Process Control / Monitoramento Ambiental) √© substancialmente mais complexo do que o mapeado.</strong> Existem 15 tabelas <code>CA_AMOSTRA*</code> + 14 tabelas <code>FDB_PCO_*</code> cobrindo coletas autom√°ticas via tags de equipamento (SAP MII tags), regras de alarme, notifica√ß√µes e hist√≥rico. O m√≥dulo "Monitoramento Ambiental" como descrito na Wave 1 pode estar subestimado em escopo.
  </div>
</section>

<!-- MODELO CORE -->
<section id="modelo-core" class="section-nav">
  <h2><span class="icon">üèóÔ∏è</span> Modelo de Dados Core ‚Äî Receita, Execu√ß√£o e Dossi√™</h2>

  <h3>1. Entidade Central: Ordem de Produ√ß√£o</h3>
  <p style="margin-bottom:12px; color:#444; line-height:1.65;">Tudo no legado gira em torno de <code>CD_ORDEM_PRODU</code>. Esta √© a chave universal que aparece em ~80% das tabelas FDB. N√£o existe um conceito de "receita" desacoplado da ordem ‚Äî a receita <strong>√© executada no contexto da OP</strong>.</p>

  <div class="table-card">
    <h4>FDB_ORDEM_PRODUCAO ‚Äî Tabela raiz do modelo</h4>
    <p>Cont√©m a ordem de produ√ß√£o com dados de planejamento SAP, status de aprova√ß√£o (Produ√ß√£o, Controle de Qualidade, Libera√ß√£o), fluxo de corre√ß√£o GxP, campos de hist√≥rico inline e flags de ciclo de vida. √â o agregado raiz ‚Äî tudo se relaciona a ela via <code>CD_ORDEM_PRODU</code>.</p>
    <div class="cols">
      <span class="col-tag pk">CD_ORDEM_PRODU (PK)</span>
      <span class="col-tag key">CD_MATER</span>
      <span class="col-tag key">CD_LOTE</span>
      <span class="col-tag key">CD_STATUS</span>
      <span class="col-tag">DT_PLANE_INICI / DT_PLANE_FIM</span>
      <span class="col-tag">DT_INICI_REAL / DT_ENCER</span>
      <span class="col-tag audit">DATA_APROV_PRODU / USUAR_APROV_PRODU</span>
      <span class="col-tag audit">DATA_APROV_CQ / USUAR_APROV_CQ</span>
      <span class="col-tag audit">DATA_APROV_LIBER / USUAR_APROV_LIBER</span>
      <span class="col-tag">FL_CORRECAO / FL_CORRIGIDO</span>
      <span class="col-tag">CD_FLUXO_SET_CORRECAO</span>
      <span class="col-tag">VERSAO_PROD</span>
      <span class="col-tag audit">INSERT_USER / UPDATE_USER / INSERT_TIMESTAMP / UPDATE_TIMESTAMP</span>
    </div>
  </div>

  <div class="insight blue">
    <strong>Insight arquitetural:</strong> O legado tem 3 est√°gios de aprova√ß√£o embutidos na pr√≥pria tabela da OP (PRODU, CQ, LIBER) ‚Äî cada um com data e usu√°rio inline. No Kronix EBR, o design do BPR (Dossi√™) precisa refletir esse fluxo tri-etapas. N√£o √© apenas "aprova√ß√£o GQ" ‚Äî s√£o tr√™s assinaturas distintas com pap√©is e timestamps separados.
  </div>

  <h3>2. Estrutura da Receita e Execu√ß√£o</h3>

  <div class="relation-diagram">
    <span class="entity">FDB_ORDEM_PRODUCAO</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_OPERACAO</span> <span class="note">(opera√ß√µes / fases macro)</span><br>
    <span class="entity">FDB_ORDEM_OPERACAO</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_FASE</span> <span class="note">(steps da execu√ß√£o, com in√≠cio/fim real, respons√°vel, status)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_INSTRUCAO</span> <span class="note">(instru√ß√µes textuais da fase)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECEITA_CARACTERISTICA</span> <span class="note">(par√¢metros capturados: peso, temperatura, press√£o)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_BOM</span> <span class="note">(componentes consumidos por fase)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄ1:N‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_ORDEM_ETIQUETA</span> <span class="note">(etiquetas geradas e impressas ‚Äî campo ZPL presente)</span><br>
    <span class="entity">FDB_FASE</span> <span class="arrow">‚îÄ‚îÄN:M‚îÄ‚îÄ‚ñ∂</span> <span class="entity">FDB_RECURSO</span> <span class="note">via FDB_RECURSO_ATIVIDADE (aloca√ß√£o de equipamento/sala/linha)</span><br>
    <span class="entity">FDB_FASE_HIERARQUIA</span> <span class="arrow">‚îÄ‚îÄ grafo dirigido ‚îÄ‚îÄ‚ñ∂</span> <span class="note">(predecessores ‚Äî a receita J√Å √â um grafo, n√£o uma lista linear)</span>
  </div>

  <div class="insight green">
    <strong>Confirma√ß√£o arquitetural importante:</strong> A tabela <code>FDB_FASE_HIERARQUIA</code> (CD_FASE ‚Üí CD_FASE_ANTEC) confirma que o legado j√° modela a receita como um <strong>grafo dirigido</strong> (DAG). O React Flow como engine visual para o Kronix EBR est√° alinhado com o modelo mental do legado ‚Äî n√£o √© uma inova√ß√£o de ruptura, √© uma moderniza√ß√£o da representa√ß√£o.
  </div>

  <div class="two-col">
    <div class="table-card">
      <h4>FDB_FASE ‚Äî Step da execu√ß√£o</h4>
      <p>Granularidade real de execu√ß√£o. Cada fase tem in√≠cio e fim real, usu√°rio de in√≠cio/fim, status, centro de trabalho, flag de confirma√ß√£o SAP e flag de corre√ß√£o GxP.</p>
      <div class="cols">
        <span class="col-tag pk">CD_FASE + CD_ORDEM_PRODU</span>
        <span class="col-tag fk">CD_OPERA</span>
        <span class="col-tag key">CD_STATUS</span>
        <span class="col-tag audit">DT_INICI / CD_USER_INICI</span>
        <span class="col-tag audit">DT_FINAL / CD_USER_FINAL</span>
        <span class="col-tag">FL_CORRECAO / FL_CHECKLIST</span>
        <span class="col-tag">FL_CONSUMO_SAP</span>
        <span class="col-tag">CD_USER_NOTA_D_GQ / DT_USER_NOTA_D_GQ</span>
      </div>
    </div>
    <div class="table-card">
      <h4>FDB_RECEITA_CARACTERISTICA ‚Äî Par√¢metros capturados</h4>
      <p>Captura de par√¢metros por instru√ß√£o: valor, forma de captura, data de execu√ß√£o, usu√°rio e flag de controle (CQ validou). Este √© o cora√ß√£o do "formul√°rio de execu√ß√£o" do legado.</p>
      <div class="cols">
        <span class="col-tag pk">CD_ORDEM_PRODU + CD_INSTR + CD_SEQUE</span>
        <span class="col-tag key">CD_CARAC</span>
        <span class="col-tag key">VL_CARAC</span>
        <span class="col-tag audit">DT_EXECU / CD_EXECU_USUA</span>
        <span class="col-tag">FL_CONTR / CD_USER_CONTR</span>
        <span class="col-tag">VL_CARAC_BKP</span>
      </div>
    </div>
  </div>

  <h3>3. Dossi√™ de Lote (BPR)</h3>

  <div class="table-card">
    <h4>FDB_DOSSIE ‚Äî Registro de Dossi√™ por OP</h4>
    <p>O dossi√™ √© gerado como arquivo (provavelmente PDF/XML) e referenciado aqui com categoria, subcategoria, status e caminho de arquivo. O campo <code>CD_FLUXO_SET_CORRECAO</code> indica que existe um fluxo de corre√ß√£o regulat√≥ria com workflow pr√≥prio.</p>
    <div class="cols">
      <span class="col-tag pk">CD_DOSSI</span>
      <span class="col-tag fk">CD_ORDEM_PRODU</span>
      <span class="col-tag key">CD_STATU</span>
      <span class="col-tag">CD_CATEG / CD_SUBCA</span>
      <span class="col-tag">NM_ARQUI / DS_PATCH</span>
      <span class="col-tag">FL_CORRECAO / CD_FLUXO_SET_CORRECAO</span>
    </div>
  </div>

  <div class="insight orange">
    <strong>Gap de design:</strong> O legado tem <code>FDB_XML_DOSSIE</code>, <code>FDB_XML_DOSSIE_ORIGINAL</code> e <code>FDB_XML_DOSSIE_REPLACES</code> ‚Äî tr√™s tabelas que armazenam o XML do dossi√™ com hist√≥rico de substitui√ß√µes. Isso indica que o dossi√™ pode ser <em>re-gerado e substitu√≠do</em> durante o fluxo de corre√ß√£o GxP. O Kronix EBR precisa modelar esse ciclo: gera√ß√£o ‚Üí revis√£o ‚Üí substitui√ß√£o ‚Üí vers√£o final. Apenas armazenar o PDF no S3 sem versionamento pode ser insuficiente.
  </div>

  <h3>4. Etiquetas e Rastreabilidade de Volume</h3>
  <div class="table-card">
    <h4>FDB_ORDEM_ETIQUETA ‚Äî Ciclo de vida completo da etiqueta</h4>
    <p>Gerencia todo o ciclo: cria√ß√£o ‚Üí impress√£o ‚Üí reimpress√£o ‚Üí cancelamento ‚Üí leitura (scan) ‚Üí consumo. O campo <strong>ZPL</strong> est√° presente diretamente na tabela ‚Äî o template ZPL √© armazenado por etiqueta. Inclui hist√≥rico em <code>FDB_ORDEM_ETIQUETA_HISTO</code> e tabela de motivo de cancelamento.</p>
    <div class="cols">
      <span class="col-tag pk">CD_ETIQUETA</span>
      <span class="col-tag fk">CD_ORDEM_PRODU / CD_FASE</span>
      <span class="col-tag audit">DT_CRIADO / CD_USER_CRIADO</span>
      <span class="col-tag audit">DT_IMPRESSAO / CD_USER_IMPRESSAO</span>
      <span class="col-tag audit">DT_REIMPRESSAO / CD_USER_REIMPRESSAO</span>
      <span class="col-tag audit">DT_CANCELADO / CD_USER_CANCELADO / CD_MOTIVO_CANCELADO</span>
      <span class="col-tag audit">DT_CONSUMIDA / CD_USER_CONSUMIDA / CD_FASE_CONSUMIDA</span>
      <span class="col-tag key">ZPL</span>
    </div>
  </div>
  <div class="insight blue">
    <strong>Insight Zebra ZPL:</strong> O template ZPL √© persistido por etiqueta no legado ‚Äî n√£o √© apenas gerado no momento da impress√£o. Isso significa que o Kronix EBR precisa: (1) armazenar o template ZPL da etiqueta como parte do registro; (2) o ciclo de reimpress√£o deve recuperar o ZPL original (n√£o remontar); (3) cancelamento e motivo precisam estar no Audit Trail GxP.
  </div>

  <h3>5. Recurso ‚Äî Equipamentos e Salas</h3>
  <div class="table-card">
    <h4>FDB_RECURSO ‚Äî Equipamento / Sala / Linha</h4>
    <p>Recurso √© o conceito unificado para equipamentos, salas limpas e linhas de produ√ß√£o. Tem tipo (<code>CD_TIPO_RECUR</code>), status operacional, centro de trabalho SAP, setor e flags de OEE. Relacionado ao Logbook via <code>FDB_RECURSO_ATIVIDADE</code> (limpeza, setup, uso por OP).</p>
    <div class="cols">
      <span class="col-tag pk">CD_RECUR</span>
      <span class="col-tag fk">CD_CENTR_TRABA / CD_CENTR</span>
      <span class="col-tag key">CD_TIPO_RECUR / CD_STATU</span>
      <span class="col-tag">CD_TAG (tag IoT SAP MII)</span>
      <span class="col-tag">OEE (flag vincula√ß√£o OEE)</span>
      <span class="col-tag">CD_GRUPO / CD_SUBGRUPO / CD_AREA</span>
      <span class="col-tag">FL_INATIVO</span>
    </div>
  </div>
  <div class="insight blue">
    <strong>Insight Logbook:</strong> O Logbook no legado √© centrado no <em>Recurso</em>, n√£o na OP. <code>FDB_RECURSO_ATIVIDADE</code> registra: tipo de atividade (limpeza, sanitiza√ß√£o, calibra√ß√£o), in√≠cio/fim, usu√°rios de in√≠cio e fim/supervisor, validade da atividade e vincula√ß√£o √† OP. O <code>FL_ENCERRADO</code> em <code>FDB_LOGBOOK_COLETIVO</code> e o conceito de "tempo de vida" (<code>FDB_FR_TEMPODEVIDA</code>) indicam que o logbook controla a validade do recurso para uso ‚Äî isso √© line clearance.
  </div>
</section>

<!-- AUDIT TRAIL LEGADO -->
<section id="audit-legado" class="section-nav">
  <h2><span class="icon">üîç</span> Audit Trail Legado ‚Äî Compara√ß√£o com Design Proposto</h2>

  <div class="two-col">
    <div>
      <h3>Legado: FDB_AUDIT</h3>
      <div class="table-card">
        <h4>Granularidade: por campo alterado</h4>
        <p>Uma linha por campo modificado. Captura tabela, campo, valor antes e depois como texto simples. Sem contexto de entidade agregada.</p>
        <div class="cols">
          <span class="col-tag pk">TRAIL_ID</span>
          <span class="col-tag">ROW_ID (linha da tabela auditada)</span>
          <span class="col-tag key">TABELA</span>
          <span class="col-tag key">CAMPO</span>
          <span class="col-tag audit">DATAHORA</span>
          <span class="col-tag audit">USUARIO</span>
          <span class="col-tag">LOCAL_ID (origem: esta√ß√£o de trabalho)</span>
          <span class="col-tag key">VALOR_ANTES</span>
          <span class="col-tag key">VALOR_DEPOIS</span>
          <span class="col-tag">ACAO</span>
        </div>
      </div>
      <div class="insight orange" style="margin-top:8px;">
        <strong>Modelo field-level:</strong> Controla quais campos auditar via <code>FDB_AUDIT_CONDICOES</code> (TABELA + CAMPO + XPATH). Dele√ß√µes rastreadas em tabela separada <code>FDB_AUDIT_DELETE</code>. Existe tamb√©m <code>FDB_AUDIT_LOCAL</code> para rastrear o terminal de origem.
      </div>
    </div>
    <div>
      <h3>Proposto: ebr_audit (Kronix)</h3>
      <div class="table-card">
        <h4>Granularidade: por entidade (before/after JSONB)</h4>
        <p>Uma linha por a√ß√£o em uma entidade. Captura o estado completo anterior e posterior como JSONB. Contexto rico: actor_id via SSO, tipo de entidade, motivo.</p>
        <div class="cols">
          <span class="col-tag pk">event_id UUID</span>
          <span class="col-tag audit">timestamp_utc TIMESTAMPTZ</span>
          <span class="col-tag audit">actor_id (SSO)</span>
          <span class="col-tag key">entity_type</span>
          <span class="col-tag key">action (CREATE/SIGN/APPROVE)</span>
          <span class="col-tag key">before_state JSONB</span>
          <span class="col-tag key">after_state JSONB</span>
          <span class="col-tag">reason TEXT (motivo GxP)</span>
        </div>
      </div>
      <div class="insight green" style="margin-top:8px;">
        <strong>Modelo entity-level:</strong> Mais f√°cil de reconstruir o hist√≥rico de uma entidade. Melhor para queries GxP "mostre o hist√≥rico desta OP". Mais volume por evento, mas menor n√∫mero de linhas.
      </div>
    </div>
  </div>

  <h3>Implica√ß√µes para Migra√ß√£o Hist√≥rica</h3>
  <div class="insight red">
    <strong>Problema de migra√ß√£o:</strong> Os dois modelos <em>n√£o s√£o diretamente compat√≠veis</em>. O legado tem audit por campo (N linhas por transa√ß√£o); o Kronix ter√° audit por entidade (1 linha por transa√ß√£o com JSONB). Para migrar o hist√≥rico do audit trail legado, seria necess√°rio: agrupar as linhas do <code>FDB_AUDIT</code> por (ROW_ID, DATAHORA, USUARIO) e reconstruir o JSONB before/after por transa√ß√£o ‚Äî complexidade de ETL n√£o trivial. <strong>Confirmar com √°rea de Qualidade: o hist√≥rico do audit trail legado precisa ser migrado ou apenas preservado em read-only?</strong> Se read-only, pode ficar em um schema separado de arquivamento sem convers√£o de formato.
  </div>

  <div class="insight orange">
    <strong>LOCAL_ID ‚Äî campo ausente no design Kronix:</strong> O legado rastreia <code>LOCAL_ID</code> (terminal/esta√ß√£o de trabalho) em praticamente todas as tabelas, inclusive no Audit Trail. Em ambiente regulat√≥rio farmac√™utico isso tem relev√¢ncia: a FDA pode questionar "de qual terminal essa assinatura foi feita". O Kronix EBR precisa capturar pelo menos o IP/device-id da requisi√ß√£o e incluir no registro de assinatura eletr√¥nica. <strong>Validar com √°rea de Qualidade se LOCAL_ID √© exig√™ncia regulat√≥ria no contexto atual.</strong>
  </div>
</section>

<!-- SHARED REFERENCE DB -->
<section id="shared-ref" class="section-nav">
  <h2><span class="icon">üóÑÔ∏è</span> Candidatos ao Shared Reference Database</h2>

  <p style="margin-bottom: 16px; color: #444; line-height: 1.65;">An√°lise das tabelas do legado para identificar candidatas a migrar para o banco compartilhado entre sites. Crit√©rios: (1) dados de cadastro, n√£o de processo; (2) n√£o cont√™m CD_ORDEM_PRODU como chave; (3) tabelas pequenas (lookup); (4) referenciadas transversalmente por m√∫ltiplos m√≥dulos.</p>

  <table class="ref-table">
    <thead>
      <tr>
        <th>Tabela Legado</th>
        <th>Colunas Chave</th>
        <th>Classifica√ß√£o</th>
        <th>Observa√ß√£o</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>FDB_UNIDADE_MEDIDA</code></td>
        <td>CD_UM, DS_UM</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Referenciada em BOM, volumes, receita. Padr√£o universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_RECURSO</code></td>
        <td>CD_TIPO_RECUR, DS_TIPO, FL_INTER</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de equipamento: sala limpa, equipamento, linha. Universal entre sites.</td>
      </tr>
      <tr>
        <td><code>FDB_STATUS_RECURSO</code></td>
        <td>CD_STATU, NM_STATU, NM_STATU2</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status do equipamento: dispon√≠vel, em limpeza, em manuten√ß√£o. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_MATERIAL</code></td>
        <td>CD_TIPO_MATER, DS_TIPO_MATER</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de material farmac√™utico. Universal entre sites EMS.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_MOVIMENTO</code></td>
        <td>CD_TIPO_MOVIM, DS_TIPO_MOVIM</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de movimento de material (consumo, devolu√ß√£o, perda). Alinhado com SAP MM.</td>
      </tr>
      <tr>
        <td><code>FDB_TURNO</code></td>
        <td>Turno, descri√ß√£o, hor√°rios</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Turnos de produ√ß√£o podem variar por site/f√°brica. <strong>Hip√≥tese:</strong> se os turnos s√£o padronizados no Grupo NC, √© shared. Confirmar.</td>
      </tr>
      <tr>
        <td><code>FDB_PERFIS</code></td>
        <td>PERFIL</td>
        <td><span class="pill risk">Aten√ß√£o ‚Äî impacto regulat√≥rio</span></td>
        <td>Perfis de acesso. Se compartilhado, uma mudan√ßa de perfil afeta todos os sites. Exige controle de mudan√ßa GxP. Avaliar se melhor manter por site.</td>
      </tr>
      <tr>
        <td><code>FDB_TELAS_ASSINATURA</code></td>
        <td>CD_TELA, CD_ROLE</td>
        <td><span class="pill risk">Aten√ß√£o ‚Äî impacto regulat√≥rio</span></td>
        <td>Define quais telas exigem assinatura eletr√¥nica por role. Se compartilhado, qualquer mudan√ßa altera requisitos de assinatura em todos os sites ‚Äî impacto GxP direto. <strong>Confirmar com √°rea de Qualidade.</strong></td>
      </tr>
      <tr>
        <td><code>FDB_ASSINATURA_CONTROLE</code></td>
        <td>CD_ACAO, PERFIS, RESTRICOES</td>
        <td><span class="pill risk">Alto risco ‚Äî n√£o recomendar shared</span></td>
        <td>Controla quais a√ß√µes exigem assinatura por perfil e centro. √â configura√ß√£o regulat√≥ria de alto impacto. Manter por site para isolamento de valida√ß√£o.</td>
      </tr>
      <tr>
        <td><code>FDB_ATIVIDADE / FDB_ATIVIDADE_TIPO</code></td>
        <td>CD_ATIVI, DS_ATIVI, CD_TIPO_ATIVI</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Tipos de atividade de logbook (limpeza, calibra√ß√£o, sanitiza√ß√£o). Provavelmente universal.</td>
      </tr>
      <tr>
        <td><code>FDB_DISCIPLINA</code></td>
        <td>CD_DISCI, DS_DISCI</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Disciplinas GxP para logbook. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_DOSSIE_CATEGORIA / FDB_DOSSIE_SUBCATEGORIA</code></td>
        <td>CD_CATEG, DS_CATEG, CD_SUBCA</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Categorias de dossi√™. Podem ser padronizadas ou variar por produto/site.</td>
      </tr>
      <tr>
        <td><code>FDB_DOSSIE_STATUS</code></td>
        <td>CD_STATU, DS_STATU</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status do dossi√™: Em elabora√ß√£o, Aguardando GQ, Aprovado, etc. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ORDEM_RECON_STATUS</code></td>
        <td>FL_STATU, DS_STATU</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status de reconcilia√ß√£o de lote. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ORDEM_STATUS</code></td>
        <td>CD_STATUS, DS_STATUS</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Status da OP. Alinhado com status SAP. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_VALIDACAO</code></td>
        <td>CD_TIPO_VALID</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de valida√ß√£o de par√¢metro. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_ANEXO_TIPO_QUESTAO</code></td>
        <td>CD_TIPO_QUEST, DS_TIPO_QUEST</td>
        <td><span class="pill shared">Shared ‚Äî forte candidato</span></td>
        <td>Tipos de quest√£o do formul√°rio: resposta livre, op√ß√£o, calculada, estat√≠stica. Universal.</td>
      </tr>
      <tr>
        <td><code>FDB_TIPO_STATUS_AMOSTRA / CA_AMOSTRA_STATUS</code></td>
        <td>CD_STATUS_AMOST, DS_STATUS_AMOST</td>
        <td><span class="pill shared">Shared ‚Äî avaliar</span></td>
        <td>Status de amostras. Pode ser universal ou variar por processo anal√≠tico do site.</td>
      </tr>
    </tbody>
  </table>

  <div class="insight orange" style="margin-top: 20px;">
    <strong>Recomenda√ß√£o:</strong> Tabelas de <em>configura√ß√£o regulat√≥ria</em> ‚Äî <code>FDB_ASSINATURA_CONTROLE</code>, <code>FDB_TELAS_ASSINATURA</code>, <code>FDB_PERFIS</code> e <code>FDB_AUDIT_CONDICOES</code> ‚Äî <strong>n√£o devem ir para o Shared Reference DB</strong>. Qualquer mudan√ßa nelas tem impacto no sistema validado e requer controle de mudan√ßa GxP por site. Mant√™-las no banco de cada site preserva o isolamento de valida√ß√£o. Coloc√°-las no banco compartilhado aumenta o risco regulat√≥rio.
  </div>
</section>

<!-- GAP ANALYSIS -->
<section id="gap-analysis" class="section-nav">
  <h2><span class="icon">üîé</span> Gap Analysis ‚Äî O que existe no legado e est√° fora do design atual</h2>

  <table class="gap-table">
    <thead>
      <tr>
        <th style="width:22%">Funcionalidade</th>
        <th style="width:20%">Tabelas Legado</th>
        <th style="width:13%">Status Kronix</th>
        <th style="width:45%">Observa√ß√£o / Risco</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Controle de Ponto / Absente√≠smo detalhado</strong></td>
        <td><code>FDB_ABS_CONTROLE_PONTO</code><br><code>FDB_ABS_CONTROLE_PONTO_HISTORICO</code><br><code>FDB_ABS_VIEW_CONTROLE_PONTO_CATRACA</code></td>
        <td><span class="pill future">Wave futura</span></td>
        <td>O legado tem integra√ß√£o com catraca e rel√≥gio de ponto (3 views separadas). O m√≥dulo de Absente√≠smo no Kronix √© listado como wave futura, mas o legado sugere que √© mais complexo do que simplesmente registrar aus√™ncia ‚Äî h√° controle de jornada com integra√ß√£o de hardware de acesso f√≠sico.</td>
      </tr>
      <tr>
        <td><strong>Habilidade por usu√°rio/linha</strong></td>
        <td><code>FDB_ABS_HABILIDADE</code><br><code>FDB_ABS_USUARIO_LINHA_HABILIDADE</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Controla quais habilidades um operador tem por linha de produ√ß√£o. √â GxP ‚Äî um operador sem habilidade certificada para aquela linha n√£o deveria poder iniciar uma fase. Impacto: m√≥dulo de Execu√ß√£o pode precisar de verifica√ß√£o de habilidade no momento do in√≠cio da fase. <strong>Validar com √°rea de Qualidade.</strong></td>
      </tr>
      <tr>
        <td><strong>N√£o-Conformidade de Aloca√ß√£o</strong></td>
        <td><code>FDB_ABS_AUTORIZA_NAO_CONFORME</code><br><code>FDB_ABS_AUTORIZA_NAO_CONFORME_RECURSO</code><br><code>FDB_ABS_AUTORIZA_NAO_CONFORME_EQUIPE</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Autoriza√ß√£o expl√≠cita para alocar operador "n√£o conforme" (fora de habilidade, com restri√ß√£o). Requer aprova√ß√£o de supervisor. √â um fluxo GxP relevante ‚Äî contorna uma barreira de seguran√ßa com rastreabilidade. N√£o est√° no design atual do Kronix EBR.</td>
      </tr>
      <tr>
        <td><strong>PCO ‚Äî Coletas autom√°ticas via tag SAP MII</strong></td>
        <td><code>FDB_PCO_TAGS</code><br><code>FDB_PCO_TAG_VAL</code><br><code>FDB_PCO_GRUPO_REGRA</code><br><code>FDB_PCO_COLETAS_CHECKMASTER</code></td>
        <td><span class="pill wave1">Wave 1 ‚Äî escopo menor</span></td>
        <td>O PCO atual usa tags do SAP MII para leitura autom√°tica de par√¢metros (temperatura, peso, press√£o) com regras de alarme por f√≥rmula. O design atual do Kronix EBR menciona "Monitoramento Ambiental" com amostras manuais. A coleta autom√°tica via Kafka/IoT pode ser o substituto ‚Äî mas o modelo de regras de alarme (<code>FDB_PCO_TP_REGRA</code>, <code>FDB_PCO_GRUPO_REGRA</code>) n√£o est√° no design. <strong>Risco de escopo subestimado.</strong></td>
      </tr>
      <tr>
        <td><strong>Controle de Amostras (CA)</strong></td>
        <td><code>CA_AMOSTRA</code> (36 cols)<br><code>CA_AMOSTRA_H</code><br><code>CA_AMOSTRA_CAIXA / PALETE / PRO</code></td>
        <td><span class="pill future">Wave futura</span></td>
        <td>O m√≥dulo CA √© uma sub-plataforma completa com rastreabilidade de amostras por caixa, palete e PRO (processo). 15 tabelas com hist√≥rico pr√≥prio (<code>_H</code>). Muito mais complexo que "Controle de Amostra" como item de lista. Sugere integra√ß√£o com laborat√≥rio (LIMS) ‚Äî confirmar.</td>
      </tr>
      <tr>
        <td><strong>Hold Time de Processo</strong></td>
        <td><code>FDB_HT_PROCESSO</code><br><code>FDB_HT_PROCESSO_ORDEM</code><br><code>FDB_ORDEM_HOLDTIME_DATA</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Hold Time √© o tempo m√°ximo permitido entre fases farmac√™uticas (ex: pesagem ‚Üí granula√ß√£o deve ocorrer em at√© X horas). √â um requisito GxP cr√≠tico ‚Äî se o hold time vence, o lote √© reprovado. N√£o est√° no design atual do Kronix EBR. <strong>Confirmar com √°rea de Qualidade se √© exig√™ncia para Wave 1 RBBL.</strong></td>
      </tr>
      <tr>
        <td><strong>Reconcilia√ß√£o de Lote</strong></td>
        <td><code>FDB_ORDEM_RECON</code><br><code>FDB_ORDEM_RECON_COMPONENTE</code><br><code>FDB_ORDEM_RECON_HISTORICO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Reconcilia√ß√£o √© o processo GxP de fechar o balan√ßo de massa: quantidade consumida + devolvida + perdida = quantidade recebida. Necess√°rio para fechamento da OP e gera√ß√£o do BPR. O design atual do Kronix menciona BPR mas n√£o inclui o m√≥dulo de reconcilia√ß√£o como entidade expl√≠cita.</td>
      </tr>
      <tr>
        <td><strong>Integridade de Dados da OP</strong></td>
        <td><code>FDB_ORDEM_INTEGRIDADE_DADOS</code><br><code>FDB_ORDEM_INTEG_DADOS_ITENS</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Checklist de integridade de dados antes do fechamento da OP ‚Äî verifica se todos os campos obrigat√≥rios foram preenchidos, assinaturas realizadas, reconcilia√ß√£o fechada. √â o "gate de qualidade" antes de gerar o dossi√™ final. N√£o est√° expl√≠cito no design atual.</td>
      </tr>
      <tr>
        <td><strong>Checklist entre Opera√ß√µes</strong></td>
        <td><code>FDB_ORDEM_CHECKLIST_CAB</code><br><code>FDB_ORDEM_CHECKLIST_ITENS</code><br><code>FDB_ORDEM_CHECKLIST_OUTROS</code></td>
        <td><span class="pill future">Wave futura</span></td>
        <td>O legado tem checklist por opera√ß√£o com aprova√ß√£o de l√≠der e GQ, detec√ß√£o de diverg√™ncias e campo de justificativa. √â substancialmente mais rico que um "Forms Checklist" gen√©rico. O <code>FDB_ORDEM_CHECKLIST_ITENS</code> tem 32 colunas incluindo multi-assinatura (LIDER, GQ, LOG, SIGN1, SIGN2).</td>
      </tr>
      <tr>
        <td><strong>Filtros de Processo</strong></td>
        <td><code>FDB_ORDEM_INTEG_FILTRO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Controle de integridade de filtros usados no processo farmac√™utico: n√∫mero de s√©rie, tipo, teste antes/depois do uso, par√¢metros de fora-de-especifica√ß√£o. √â um controle GxP regulat√≥rio espec√≠fico para formas farmac√™uticas est√©reis. Confirmar com √°rea de Qualidade se aplica a RBBL.</td>
      </tr>
      <tr>
        <td><strong>Retrabalho de Lote</strong></td>
        <td><code>FDB_ORDEM_PRODUCAO.CD_STATUS_RETRABALHO</code><br><code>FDB_ORDEM_PRODUCAO.DT_STATUS_RETRABALHO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Status de retrabalho com data e usu√°rio inline na OP. Reprocessamento de lote tem requisitos GxP espec√≠ficos ‚Äî nova OP, novo dossi√™, rastreabilidade do lote original. N√£o est√° no design atual.</td>
      </tr>
      <tr>
        <td><strong>Rastreabilidade de Transfer√™ncia de Volume</strong></td>
        <td><code>FDB_ORDEM_TRANSFERENCIA</code><br><code>FDB_ORDEM_TRANSFERENCIA_VOLUME</code><br><code>FDB_ORDEM_DEVOLUCAO</code></td>
        <td><span class="pill gap">N√£o mapeado</span></td>
        <td>Transfer√™ncia de volume entre ordens (semi-acabado para acabado) e devolu√ß√£o ao almoxarifado com envio SAP. Fluxos de log√≠stica interna farmac√™utica com rastreabilidade de lote. Pode ser parte do escopo da NT (Necessidade de Transporte) integrado via SAP CPI.</td>
      </tr>
    </tbody>
  </table>

  <div class="insight red" style="margin-top: 20px;">
    <strong>Gap priorit√°rio para valida√ß√£o antes de fechar o escopo Wave 1:</strong> <strong>Hold Time</strong> e <strong>Reconcilia√ß√£o de Lote</strong> s√£o processos GxP fundamentais que provavelmente existem no RBBL. Se forem exigidos para fechamento do BPR no Go Live dez/2026 e n√£o estiverem no escopo, o risco de atraso √© alto. Confirmar com Gustavo Fontes (Tech Lead EBR legado) se esses m√≥dulos s√£o pr√©-requisito para gera√ß√£o do dossi√™ de lote no RBBL.
  </div>
</section>

<!-- MIGRA√á√ÉO -->
<section id="migracao" class="section-nav">
  <h2><span class="icon">üöö</span> Insumos para Estrat√©gia de Migra√ß√£o</h2>

  <h3>Complexidade por m√≥dulo</h3>
  <div class="three-col">
    <div class="table-card">
      <h4>üü¢ Baixa complexidade</h4>
      <p>Tabelas de lookup / refer√™ncia ‚Äî migra√ß√£o direta de dados est√°ticos. Sem depend√™ncia de OP.</p>
      <div class="cols">
        <span class="col-tag">FDB_UNIDADE_MEDIDA</span>
        <span class="col-tag">FDB_TIPO_RECURSO</span>
        <span class="col-tag">FDB_ORDEM_STATUS</span>
        <span class="col-tag">FDB_DOSSIE_STATUS</span>
        <span class="col-tag">FDB_TURNO</span>
        <span class="col-tag">FDB_DISCIPLINA</span>
      </div>
    </div>
    <div class="table-card">
      <h4>üü° M√©dia complexidade</h4>
      <p>Dados mestre ‚Äî Recurso, Material, Usu√°rio. Depend√™ncias de SAP e de outros sistemas.</p>
      <div class="cols">
        <span class="col-tag">FDB_RECURSO (+ param, + POP)</span>
        <span class="col-tag">FDB_MATERIAL (+ lote, + centro)</span>
        <span class="col-tag">FDB_USUARIOS</span>
        <span class="col-tag">FDB_PERFIS + FDB_USUARIO_PERFIL</span>
        <span class="col-tag">FDB_RECEITA_CABECALHO</span>
      </div>
    </div>
    <div class="table-card">
      <h4>üî¥ Alta complexidade</h4>
      <p>Dados de processo ‚Äî OP, execu√ß√£o, audit trail, dossi√™. Volume alto, depend√™ncias cruzadas, requisitos regulat√≥rios.</p>
      <div class="cols">
        <span class="col-tag">FDB_ORDEM_PRODUCAO (~hist√≥rico completo)</span>
        <span class="col-tag">FDB_FASE + FDB_FASE_HIERARQUIA</span>
        <span class="col-tag">FDB_AUDIT (campo a campo)</span>
        <span class="col-tag">FDB_DOSSIE + FDB_XML_DOSSIE*</span>
        <span class="col-tag">FDB_RECURSO_ATIVIDADE (logbook)</span>
        <span class="col-tag">CA_AMOSTRA* (15 tabelas)</span>
      </div>
    </div>
  </div>

  <h3>Pontos cr√≠ticos para decis√£o de cutover</h3>
  <div class="insight orange">
    <strong>Dois schemas de Audit Trail incompat√≠veis.</strong> Migrar o hist√≥rico de <code>FDB_AUDIT</code> (field-level) para o formato JSONB do Kronix requer ETL complexo. Alternativa mais pragm√°tica: manter <code>FDB_AUDIT</code> legado em um schema <code>ebr_legacy_audit</code> somente leitura por 5 anos, com acesso via Kibana ou query direta. Isso evita convers√£o e garante imutabilidade do hist√≥rico regulat√≥rio sem custo de desenvolvimento.
  </div>
  <div class="insight blue">
    <strong>Dossi√™s XML hist√≥ricos.</strong> O legado armazena o dossi√™ como XML em banco de dados (<code>FDB_XML_DOSSIE</code>). A estrat√©gia mais simples para preserva√ß√£o regulat√≥ria √© exportar esses XMLs para S3 Object Lock (WORM) durante o cutover ‚Äî sem convers√£o, apenas arquivamento com reten√ß√£o 5 anos. Acesso posterior via pre-signed URL para auditorias.
  </div>
  <div class="insight blue">
    <strong>Paralelo de opera√ß√£o (parallel run).</strong> Dado que o legado usa SAP MII como plataforma (com tags de equipamento, integra√ß√µes de IDoc), o parallel run vai gerar dados duplicados em dois sistemas. Definir claramente: (1) qual sistema √© source of truth durante o paralelo; (2) como reconciliar diverg√™ncias; (3) crit√©rio de cut off por lote ou por data.
  </div>

  <h3>Pergunta de neg√≥cio para validar com Gustavo Fontes</h3>
  <div class="insight red">
    <strong>A migra√ß√£o hist√≥rica de lotes est√° mesmo fora do escopo?</strong> O modelo legado tem <code>FDB_ORDEM_PRODUCAO_HISTO</code>, <code>FDB_FASE_HISTO</code>, <code>FDB_ORDEM_BOM_HISTO</code> ‚Äî tabelas de hist√≥rico de todas as entidades principais. Regulatoriamente, se um inspetor da ANVISA pede o hist√≥rico de um lote de 2 anos atr√°s ap√≥s o Go Live, onde ele vai buscar? Se a resposta for "no sistema legado que ainda estar√° rodando em modo read-only", isso precisa estar documentado no plano de valida√ß√£o (VSC). Se a resposta for "no Kronix EBR", a migra√ß√£o hist√≥rica <em>n√£o pode ser out-of-scope</em>.
  </div>
</section>

</main>

<footer>
  An√°lise gerada a partir de FDBs.graphml ‚Äî Banco Legado EBR EMS ¬∑ Kronix EBR ¬∑ NC Tech<br>
  ‚ö† Hip√≥teses sinalizadas devem ser validadas com Gustavo Fontes, √°rea de Qualidade e Consultoria GxP antes de qualquer decis√£o arquitetural.
</footer>

<script>
  // Nav active state on scroll
  const sections = document.querySelectorAll('.section-nav');
  const navLinks = document.querySelectorAll('nav a');
  window.addEventListener('scroll', () => {
    let current = '';
    sections.forEach(s => {
      if (window.scrollY >= s.offsetTop - 80) current = s.id;
    });
    navLinks.forEach(a => {
      a.classList.toggle('active', a.getAttribute('href') === '#' + current);
    });
  });
</script>
</body>
</html>
